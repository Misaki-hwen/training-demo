<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多角色培训管理系统</title>
    <!-- Import Styles -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <style>
        body {
            margin: 0;
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', '微软雅黑', Arial, sans-serif;
            background-color: #f5f7fa;
            height: 100vh;
        }
        #app {
            height: 100%;
        }
        .layout-container {
            height: 100%;
        }
        .app-sidebar {
            background-color: #304156;
            color: #fff;
            transition: width 0.3s;
            overflow-x: hidden;
        }
        .logo-container {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2b2f3a;
            color: #fff;
            font-weight: bold;
            font-size: 18px;
            white-space: nowrap;
            overflow: hidden;
        }
        .el-header {
            background-color: #fff;
            border-bottom: 1px solid #dcdfe6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            height: 60px;
        }
        .el-main {
            padding: 20px;
            background-color: #f0f2f5;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .filter-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .section-title {
            margin: 20px 0 10px;
            font-weight: bold;
            font-size: 16px;
            border-left: 4px solid #409EFF;
            padding-left: 10px;
        }
        .student-app-shell {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 16px 0;
        }
        .student-app-container {
            width: 100%;
            max-width: 420px;
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .student-app-main {
            flex: 1;
            padding: 12px 12px 64px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .student-app-tabbar {
            display: flex;
            border-top: 1px solid #ebeef5;
            background: #ffffff;
            height: 56px;
        }
        .student-app-tabbar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #909399;
            cursor: pointer;
        }
        .student-app-tabbar-item.active {
            color: #409EFF;
        }
        .student-app-tabbar-icon {
            margin-bottom: 2px;
        }
        .student-app-tabbar-text {
            line-height: 1;
        }
        .student-app-page {
            padding: 4px;
        }
        .student-app-header {
            padding: 8px 4px 12px;
        }
        .student-app-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .student-app-subtitle {
            font-size: 12px;
            color: #909399;
        }
        .student-app-search {
            padding: 0 4px 12px;
        }
        .student-app-card-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 0 4px 12px;
        }
        .student-app-card {
            background: #f9fafc;
            border-radius: 12px;
            padding: 10px 12px;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }
        .student-app-card-main {
            flex: 1;
            margin-right: 8px;
        }
        .student-app-card-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        .student-app-card-title {
            font-size: 14px;
            font-weight: 600;
        }
        .student-app-card-meta {
            font-size: 12px;
            color: #909399;
            margin-bottom: 4px;
        }
        .student-app-card-progress-text {
            font-size: 12px;
            color: #606266;
        }
        .student-app-card-footer {
            display: flex;
            align-items: center;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .app-sidebar {
                width: 64px !important;
            }
            .logo-text {
                display: none;
            }
            .el-menu-item span {
                display: none;
            }
            .el-menu--collapse {
                width: 64px;
            }
        }
    </style>
    <!-- Import Scripts -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <script src="https://unpkg.com/echarts/dist/echarts.min.js"></script>
</head>
<body>
    <div id="app">
        <el-container class="layout-container">
            <!-- Left Sidebar -->
            <el-aside width="220px" class="app-sidebar">
                <div class="logo-container">
                    <el-icon :size="24" style="margin-right: 8px;"><Management /></el-icon>
                    <span class="logo-text">培训管理系统</span>
                </div>
                <el-menu
                    :default-active="activePath"
                    router
                    background-color="#304156"
                    text-color="#bfcbd9"
                    active-text-color="#409EFF"
                    style="border-right: none;"
                >
                    <el-sub-menu index="/enterprise">
                        <template #title>
                            <el-icon><Office-Building /></el-icon>
                            <span>企业端</span>
                        </template>
                        <el-menu-item index="/enterprise?tab=plan">计划管理</el-menu-item>
                        <el-menu-item index="/enterprise?tab=screening">学生筛选</el-menu-item>
                        <el-menu-item index="/enterprise?tab=confirmation">名单确认</el-menu-item>
                        <el-menu-item index="/enterprise?tab=monitoring">培训考勤</el-menu-item>
                        <el-menu-item index="/enterprise?tab=results">考核结果</el-menu-item>
                        <el-menu-item index="/enterprise?tab=talent">人才库</el-menu-item>
                        <el-menu-item index="/enterprise?tab=settlement">财务结算</el-menu-item>
                    </el-sub-menu>

                    <el-sub-menu index="/operation">
                        <template #title>
                            <el-icon><Setting /></el-icon>
                            <span>运营端</span>
                        </template>
                        <el-menu-item index="/operation?tab=audit">计划审核</el-menu-item>
                        <el-menu-item index="/operation?tab=config">培训管理</el-menu-item>
                        <el-menu-item index="/operation?tab=courses">课程管理</el-menu-item>
                        <el-menu-item index="/operation?tab=student">学生管理</el-menu-item>
                        <el-menu-item index="/operation?tab=settlement">结算管理</el-menu-item>
                    </el-sub-menu>

                    <el-sub-menu index="/school">
                        <template #title>
                            <el-icon><School /></el-icon>
                            <span>学校端</span>
                        </template>
                        <el-menu-item index="/school?tab=training">培训管理</el-menu-item>
                        <el-menu-item index="/school?tab=attendance">考勤管理</el-menu-item>
                        <el-menu-item index="/school?tab=assessment">考核结果</el-menu-item>
                    </el-sub-menu>

                    <el-sub-menu index="/student">
                        <template #title>
                            <el-icon><User /></el-icon>
                            <span>学生端</span>
                        </template>
                        <el-menu-item index="/student?tab=registration">培训报名</el-menu-item>
                        <el-menu-item index="/student?tab=mytraining">我的培训</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </el-aside>

            <!-- Main Content Area -->
            <el-container>
                <el-header>
                    <div class="header-left">
                        <h3 style="margin: 0; color: #303133;">{{ currentRoleTitle }}</h3>
                    </div>
                    <div class="user-info">
                        <el-avatar :size="32" icon="UserFilled"></el-avatar>
                        <span style="margin-left: 10px; font-size: 14px;">管理员</span>
                    </div>
                </el-header>
                <el-main>
                    <router-view></router-view>
                </el-main>
            </el-container>
        </el-container>
    </div>

    <!-- TEMPLATES -->

    <!-- ================= 1. ENTERPRISE TEMPLATES ================= -->
    <script type="text/x-template" id="tmpl-plan-management">
        <div class="plan-management">
            <div class="card-header">
                <h3>计划管理</h3>
                <el-button type="primary" @click="handleCreate">创建计划</el-button>
            </div>
            <div class="filter-container">
                <el-input v-model="searchQuery" placeholder="搜索计划名称" style="width: 200px;"></el-input>
                <el-select v-model="filterStatus" placeholder="状态" clearable style="width: 120px;">
                    <el-option label="草稿" value="Draft"></el-option>
                    <el-option label="待审核" value="Pending"></el-option>
                    <el-option label="审核中" value="Auditing"></el-option>
                    <el-option label="已通过" value="Approved"></el-option>
                    <el-option label="已驳回" value="Rejected"></el-option>
                </el-select>
                <el-button type="primary" icon="Search" @click="handleSearch">搜索</el-button>
            </div>
            <el-table :data="tableData" style="width: 100%" border v-loading="loading">
                <el-table-column type="index" label="序号" width="60"></el-table-column>
                <el-table-column label="计划名称" min-width="150">
                    <template #default="scope">
                        <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleDetail(scope.row)">{{ scope.row.planName }}</span>
                    </template>
                </el-table-column>
                <el-table-column prop="positionType" label="岗位类型" width="120"></el-table-column>
                <el-table-column prop="headcount" label="需求人数" width="100"></el-table-column>
                <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                        <el-tag :type="getStatusType(scope.row.status)">{{ getStatusLabel(scope.row.status) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column prop="submitTime" label="提交时间" width="160"></el-table-column>
                <el-table-column label="操作" width="280" fixed="right">
                    <template #default="scope">
                        <el-button size="small" type="primary" v-if="['Draft', 'Rejected'].includes(scope.row.status)" @click="handleEdit(scope.row)">编辑</el-button>
                        <el-button size="small" type="success" v-if="['Draft', 'Rejected'].includes(scope.row.status)" @click="handleSubmit(scope.row)">提交审核</el-button>
                        <el-button size="small" type="danger" v-if="['Draft', 'Rejected'].includes(scope.row.status)" @click="handleDelete(scope.row)">删除</el-button>
                    </template>
                </el-table-column>
            </el-table>

            <!-- Create/Edit Dialog -->
            <el-dialog v-model="dialogVisible" :title="dialogTitle" width="65%" top="5vh">
                <el-form :model="form" :rules="rules" ref="formRef" label-width="120px" :disabled="isViewMode">
                    <div class="section-title">基本信息</div>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="计划名称" prop="planName">
                                <el-input v-model="form.planName" maxlength="50" show-word-limit placeholder="50字以内"></el-input>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="岗位类型" prop="positionType">
                                <el-select v-model="form.positionType" style="width: 100%">
                                    <el-option v-for="type in positionTypes" :key="type" :label="type" :value="type"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="需求人数" prop="headcount">
                                <el-input-number v-model="form.headcount" :min="1" :max="500" style="width: 100%"></el-input-number>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="培训周期" prop="dateRange">
                                <el-date-picker v-model="form.dateRange" type="daterange" range-separator="至" start-placeholder="开始日期" end-placeholder="结束日期" value-format="YYYY-MM-DD" style="width: 100%"></el-date-picker>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    
                    <div class="section-title">培训地点</div>
                    <el-row :gutter="20">
                        <el-col :span="8">
                            <el-form-item label="省份" prop="province">
                                <el-select v-model="form.province" placeholder="请选择省份" @change="form.city = ''" style="width: 100%">
                                    <el-option v-for="p in provinceList" :key="p.value" :label="p.label" :value="p.value"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="城市" prop="city">
                                <el-select v-model="form.city" placeholder="请选择城市" style="width: 100%">
                                    <el-option v-for="c in getCityList(form.province)" :key="c.value" :label="c.label" :value="c.value"></el-option>
                                </el-select>
                            </el-form-item>
                        </el-col>
                        <el-col :span="8">
                            <el-form-item label="详细地址" prop="address">
                                <el-input v-model="form.address" placeholder="请输入详细地址"></el-input>
                            </el-form-item>
                        </el-col>
                    </el-row>

                    <div class="section-title">预算费用</div>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="培训费用(元)" prop="budgetFee">
                                <el-input-number v-model="form.budgetFee" :min="0" :precision="2" style="width: 100%"></el-input-number>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="结算方式" prop="settlementMethod">
                                <el-radio-group v-model="form.settlementMethod">
                                    <el-radio label="Post">培训后结算</el-radio>
                                    <el-radio label="Phased">分阶段结算</el-radio>
                                </el-radio-group>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-form-item label="预算说明" prop="budgetDesc">
                        <el-input v-model="form.budgetDesc" type="textarea" :rows="2" placeholder="请输入费用构成说明"></el-input>
                    </el-form-item>

                    <div class="section-title">要求信息</div>
                    <el-form-item label="学历要求" prop="education">
                        <el-checkbox-group v-model="form.education">
                            <el-checkbox label="大专">大专</el-checkbox>
                            <el-checkbox label="本科">本科</el-checkbox>
                            <el-checkbox label="硕士">硕士</el-checkbox>
                            <el-checkbox label="博士">博士</el-checkbox>
                        </el-checkbox-group>
                    </el-form-item>
                    <el-form-item label="专业要求" prop="major">
                        <el-input v-model="form.major" placeholder="可输入多个专业，用逗号分隔"></el-input>
                    </el-form-item>
                    <el-form-item label="技能要求" prop="skills">
                        <el-input v-model="form.skills" type="textarea" :rows="2" placeholder="可输入多个技能，用逗号分隔"></el-input>
                    </el-form-item>
                    <el-form-item label="备注" prop="remark">
                        <el-input v-model="form.remark" type="textarea" maxlength="500" show-word-limit></el-input>
                    </el-form-item>
                    
                    <div v-if="form.status === 'Rejected'" style="margin-top: 20px; padding: 10px; background-color: #fef0f0; border-radius: 4px;">
                        <div style="color: #f56c6c; font-weight: bold; margin-bottom: 5px;">驳回信息</div>
                        <p style="margin: 0; color: #606266;">驳回原因: {{ form.auditComment }}</p>
                        <p style="margin: 5px 0 0; color: #909399; font-size: 12px;">审核时间: {{ form.auditTime }}</p>
                    </div>
                </el-form>
                <template #footer>
                    <span class="dialog-footer">
                        <el-button @click="dialogVisible = false">{{ isViewMode ? '关闭' : '取消' }}</el-button>
                        <el-button type="primary" @click="submitForm" v-if="!isViewMode">保存</el-button>
                    </span>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-student-screening">
        <div>
            <div class="card-header"><h3>学生筛选</h3></div>
            <div class="filter-container">
                <el-select v-model="filterPlan" placeholder="选择计划" style="width: 200px;">
                    <el-option label="Java 高级后端开发特训营" value="1"></el-option>
                    <el-option label="数字化营销管培生计划" value="2"></el-option>
                </el-select>
                <el-input v-model="searchKeyword" placeholder="姓名/学校/专业" style="width: 200px;"></el-input>
                <el-button type="primary">筛选</el-button>
                <div style="flex: 1; text-align: right;">
                    <el-button type="success" @click="batchAction('Pass')">批量通过</el-button>
                    <el-button type="danger" @click="batchAction('Fail')">批量淘汰</el-button>
                </div>
            </div>
            <el-table :data="tableData" border style="width: 100%" @selection-change="handleSelectionChange">
                <el-table-column type="selection" width="55"></el-table-column>
                <el-table-column prop="name" label="姓名" width="100"></el-table-column>
                <el-table-column prop="school" label="学校" width="150"></el-table-column>
                <el-table-column prop="major" label="专业" width="150"></el-table-column>
                <el-table-column prop="education" label="学历" width="100"></el-table-column>
                <el-table-column prop="matchRate" label="匹配度" width="100" sortable>
                    <template #default="scope">{{ scope.row.matchRate }}%</template>
                </el-table-column>
                <el-table-column prop="platformStatus" label="平台初筛" width="100">
                    <template #default="scope">
                         <el-tag type="success">{{ getStatusText(scope.row.platformStatus) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column prop="enterpriseStatus" label="企业筛选" width="100">
                    <template #default="scope">
                         <el-tag :type="getStatusType(scope.row.enterpriseStatus)">{{ getStatusText(scope.row.enterpriseStatus) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" type="success" @click="updateStatus(scope.row, 'Pass')">通过</el-button>
                        <el-button size="small" type="danger" @click="updateStatus(scope.row, 'Fail')">淘汰</el-button>
                        <el-button size="small" link>查看简历</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-list-confirmation">
        <div>
            <div class="card-header"><h3>名单确认</h3></div>
            <div class="filter-container">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <el-select v-model="filterCamp" placeholder="选择培训营" style="width: 240px;">
                        <el-option v-for="c in camps" :key="c" :label="c" :value="c"></el-option>
                    </el-select>
                    <el-button type="primary" @click="handleQuery">查询</el-button>
                </div>
                <div style="flex: 1; text-align: right;">
                    <el-button type="success" @click="batchAction('Confirm')">批量确认</el-button>
                    <el-button type="warning" @click="batchAction('Abandon')">批量放弃</el-button>
                </div>
            </div>
            <el-table :data="filteredTableData" border style="width: 100%" @selection-change="handleSelectionChange">
                <el-table-column type="selection" width="55"></el-table-column>
                <el-table-column prop="name" label="姓名" width="100"></el-table-column>
                <el-table-column prop="school" label="学校"></el-table-column>
                <el-table-column prop="contact" label="联系方式" width="150"></el-table-column>
                <el-table-column prop="enterpriseStatus" label="企业筛选状态" width="120">
                     <template #default="scope"><el-tag type="success">通过</el-tag></template>
                </el-table-column>
                <el-table-column prop="confirmStatus" label="确认状态">
                    <template #default="scope">
                         <el-tag :type="getConfirmStatusType(scope.row.confirmStatus)">{{ getConfirmStatusText(scope.row.confirmStatus) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" type="success" @click="updateStatus(scope.row, 'Confirmed')">确认</el-button>
                        <el-button size="small" type="warning" @click="updateStatus(scope.row, 'Abandoned')">放弃</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-training-monitoring">
        <div>
            <div class="card-header">
                <h3>培训考勤</h3>
                <el-button type="primary" plain>导出考勤数据</el-button>
            </div>
            <div class="filter-container" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                <el-select v-model="selectedCampName" placeholder="选择培训营" style="width: 240px;">
                    <el-option v-for="c in camps" :key="c.id" :label="c.campName" :value="c.campName"></el-option>
                </el-select>
                <el-button type="primary" @click="handleQuery">查询</el-button>
            </div>
            <el-card shadow="never" style="margin-bottom: 20px;">
                <el-descriptions :title="campDetail.campName" :column="4" border>
                    <el-descriptions-item label="合作学校">{{ campDetail.school }}</el-descriptions-item>
                    <el-descriptions-item label="培训周期">{{ campDetail.startDate }} ~ {{ campDetail.endDate }}</el-descriptions-item>
                    <el-descriptions-item label="当前进度">{{ progressDays }}/{{ totalDays }} 天</el-descriptions-item>
                    <el-descriptions-item label="整体出勤率">
                        <span style="color: green; font-weight: bold;">{{ overallRate }}</span>
                    </el-descriptions-item>
                </el-descriptions>
            </el-card>

            <div class="section-title">学生出勤列表</div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                <el-table-column prop="school" label="学校"></el-table-column>
                <el-table-column prop="overallRate" label="综合出勤率" width="150">
                    <template #default="scope">
                        <el-progress :percentage="scope.row.overallRate"></el-progress>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" link @click="handleDetail(scope.row)">详情</el-button>
                    </template>
                </el-table-column>
            </el-table>

            <el-dialog v-model="detailDialogVisible" title="学员考勤详情" width="50%">
                <div v-if="currentStudent">
                    <div style="margin-bottom: 15px; font-weight: bold; font-size: 16px;">
                        {{ currentStudent.name }} ({{ currentStudent.school }})
                    </div>
                    <el-table :data="currentStudentCourseRecords" border stripe>
                        <el-table-column prop="courseName" label="课程名称"></el-table-column>
                        <el-table-column prop="courseTime" label="上课时间" width="180"></el-table-column>
                        <el-table-column prop="status" label="状态" width="100">
                             <template #default="scope">
                                 <el-tag :type="scope.row.status === 'Present' ? 'success' : (scope.row.status === 'Late' ? 'warning' : 'danger')">
                                     {{ scope.row.status === 'Present' ? '出勤' : (scope.row.status === 'Absent' ? '缺勤' : '迟到') }}
                                 </el-tag>
                             </template>
                        </el-table-column>
                        <el-table-column label="操作" width="120">
                            <template #default="scope">
                                <el-button size="small" link type="primary" @click="handleChangeStatus(scope.row)">更改状态</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
                <template #footer>
                    <el-button @click="detailDialogVisible = false">关闭</el-button>
                </template>
            </el-dialog>

            <el-dialog v-model="statusDialogVisible" title="更改出勤状态" width="30%">
                <el-form>
                    <el-form-item label="当前状态">
                        <el-tag :type="currentCourseRecord?.status === 'Present' ? 'success' : (currentCourseRecord?.status === 'Late' ? 'warning' : 'danger')">
                             {{ currentCourseRecord?.status === 'Present' ? '出勤' : (currentCourseRecord?.status === 'Absent' ? '缺勤' : '迟到') }}
                        </el-tag>
                    </el-form-item>
                    <el-form-item label="修改为">
                        <el-select v-model="newStatus" placeholder="请选择状态">
                            <el-option label="出勤" value="Present"></el-option>
                            <el-option label="缺勤" value="Absent"></el-option>
                            <el-option label="迟到" value="Late"></el-option>
                        </el-select>
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="statusDialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="confirmStatusChange">确认</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-assessment-results">
        <div>
            <div class="card-header">
                <h3>考核结果</h3>
                <el-button type="primary">批量录入成绩</el-button>
            </div>
            <div class="filter-container" style="display: flex; gap: 10px; align-items: center; margin-bottom: 20px;">
                <el-select v-model="selectedCampName" placeholder="选择培训营" style="width: 240px;">
                    <el-option v-for="c in camps" :key="c.id" :label="c.campName" :value="c.campName"></el-option>
                </el-select>
                <el-button type="primary" @click="handleQuery">查询</el-button>
            </div>
            
            <el-row :gutter="20" style="margin-bottom: 20px;">
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ statTotal }}</h3><p>参训总人数</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ statQualified }}</h3><p>达标人数</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3 style="color:green">{{ statRate }}</h3><p>达标率</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ statAvgScore }}</h3><p>平均成绩</p></div></el-card></el-col>
            </el-row>

            <div ref="chartDom" style="width: 100%; height: 300px; margin-bottom: 20px;"></div>

            <div class="section-title">考核录入</div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                <el-table-column prop="school" label="学校"></el-table-column>
                <el-table-column prop="major" label="专业"></el-table-column>
                <el-table-column label="考核成绩(0-100)" width="200">
                    <template #default="scope">
                        <el-input-number v-model="scope.row.score" :min="0" :max="100" size="small"></el-input-number>
                    </template>
                </el-table-column>
                <el-table-column label="是否达标" width="150">
                     <template #default="scope">
                         <el-switch v-model="scope.row.isQualified" active-text="达标" inactive-text="不达标"></el-switch>
                     </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope"><el-button size="small" type="primary">保存</el-button></template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-talent-pool">
        <div>
            <div class="card-header">
                <h3>人才库</h3>
                <el-button type="primary" plain>导出名单</el-button>
            </div>
            <div class="filter-container">
                <el-input placeholder="姓名/学校/专业" style="width: 200px;"></el-input>
                <el-select placeholder="来源计划" style="width: 150px;">
                    <el-option label="Spring 特训营" value="1"></el-option>
                </el-select>
                <el-button type="primary">搜索</el-button>
            </div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="name" label="姓名" width="100"></el-table-column>
                <el-table-column prop="school" label="毕业院校" width="150"></el-table-column>
                <el-table-column prop="major" label="专业" width="150"></el-table-column>
                <el-table-column prop="education" label="学历" width="100"></el-table-column>
                <el-table-column prop="planName" label="来源计划"></el-table-column>
                <el-table-column prop="score" label="考核成绩" width="100"></el-table-column>
                <el-table-column prop="entryDate" label="入库时间" width="150"></el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" type="primary" link>查看简历</el-button>
                        <el-button size="small" type="success" link>发送Offer</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-enterprise-settlement">
        <div>
            <div class="card-header"><h3>财务结算</h3></div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="orderNo" label="结算单号"></el-table-column>
                <el-table-column prop="planName" label="关联计划"></el-table-column>
                <el-table-column prop="campName" label="培训营"></el-table-column>
                <el-table-column prop="headcount" label="培训人数" width="100"></el-table-column>
                <el-table-column prop="amount" label="结算金额">
                    <template #default="scope">
                        <span style="color: #f56c6c; font-weight: bold;">{{ scope.row.amount }}</span>
                    </template>
                </el-table-column>
                <el-table-column prop="status" label="状态">
                    <template #default="scope">
                        <el-tag :type="scope.row.status === 'Paid' ? 'success' : 'warning'">
                            {{ scope.row.status === 'Paid' ? '已支付' : '待支付' }}
                        </el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" type="primary" v-if="scope.row.status !== 'Paid'" @click="handlePay(scope.row)">确认支付</el-button>
                        <el-button size="small" link>查看明细</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-enterprise-layout">
        <el-card>
            <plan-management v-if="activeTab === 'plan'"></plan-management>
            <student-screening v-if="activeTab === 'screening'"></student-screening>
            <list-confirmation v-if="activeTab === 'confirmation'"></list-confirmation>
            <training-monitoring v-if="activeTab === 'monitoring'"></training-monitoring>
            <assessment-results v-if="activeTab === 'results'"></assessment-results>
            <talent-pool v-if="activeTab === 'talent'"></talent-pool>
            <enterprise-settlement v-if="activeTab === 'settlement'"></enterprise-settlement>
        </el-card>
    </script>

    <!-- ================= 2. OPERATION TEMPLATES ================= -->
    <script type="text/x-template" id="tmpl-plan-audit">
        <div>
            <div class="card-header"><h3>计划审核</h3></div>
            <div class="filter-container">
                <el-input v-model="searchQuery" placeholder="企业/计划名称" style="width: 200px;"></el-input>
                <el-select v-model="filterStatus" placeholder="状态" style="width: 120px;">
                    <el-option label="待审核" value="Pending"></el-option>
                    <el-option label="已通过" value="Approved"></el-option>
                    <el-option label="已驳回" value="Rejected"></el-option>
                </el-select>
                <el-button type="primary">查询</el-button>
            </div>
            <el-table :data="tableData" border style="width: 100%" v-loading="loading">
                <el-table-column prop="planName" label="计划名称" min-width="150"></el-table-column>
                <el-table-column prop="enterprise" label="企业名称" width="150"></el-table-column>
                <el-table-column prop="positionType" label="岗位类型" width="120"></el-table-column>
                <el-table-column prop="headcount" label="需求人数" width="100"></el-table-column>
                <el-table-column prop="period" label="培训周期" width="200"></el-table-column>
                <el-table-column prop="submitTime" label="提交时间" width="160"></el-table-column>
                <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                        <el-tag :type="getStatusType(scope.row.status)">{{ getStatusLabel(scope.row.status) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作" width="120" fixed="right">
                    <template #default="scope">
                        <el-button size="small" type="primary" v-if="scope.row.status === 'Pending'" @click="handleAudit(scope.row)">审核</el-button>
                        <el-button size="small" v-else @click="handleView(scope.row)">查看</el-button>
                    </template>
                </el-table-column>
            </el-table>
            
            <el-dialog v-model="auditVisible" :title="isViewMode ? '计划详情' : '计划审核'" width="60%" top="5vh">
                <el-descriptions :column="2" border>
                    <el-descriptions-item label="计划名称">{{ currentPlan.planName }}</el-descriptions-item>
                    <el-descriptions-item label="企业名称">{{ currentPlan.enterprise }}</el-descriptions-item>
                    <el-descriptions-item label="岗位类型">{{ currentPlan.positionType }}</el-descriptions-item>
                    <el-descriptions-item label="需求人数">{{ currentPlan.headcount }}人</el-descriptions-item>
                    <el-descriptions-item label="培训周期">{{ currentPlan.period }}</el-descriptions-item>
                    <el-descriptions-item label="培训地点">{{ currentPlan.location }}</el-descriptions-item>
                    <el-descriptions-item label="预算费用">{{ currentPlan.budget }}</el-descriptions-item>
                    <el-descriptions-item label="学历要求">{{ currentPlan.education }}</el-descriptions-item>
                    <el-descriptions-item label="专业要求" :span="2">{{ currentPlan.major }}</el-descriptions-item>
                    <el-descriptions-item label="技能要求" :span="2">{{ currentPlan.skills }}</el-descriptions-item>
                    <el-descriptions-item label="备注" :span="2">{{ currentPlan.remark }}</el-descriptions-item>
                </el-descriptions>

                <div v-if="!isViewMode" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                    <el-form label-width="100px">
                        <el-form-item label="审核结果">
                            <el-radio-group v-model="auditResult">
                                <el-radio label="Approved">通过</el-radio>
                                <el-radio label="Rejected">驳回</el-radio>
                            </el-radio-group>
                        </el-form-item>
                        <el-form-item label="驳回原因" v-if="auditResult === 'Rejected'">
                            <el-input v-model="rejectReason" type="textarea" :rows="3" placeholder="请输入驳回原因（必填）"></el-input>
                        </el-form-item>
                    </el-form>
                </div>

                <div v-if="isViewMode && currentPlan.status === 'Rejected'" style="margin-top: 20px; padding: 15px; background-color: #fef0f0; border-radius: 4px;">
                    <p style="color: #f56c6c; font-weight: bold;">驳回原因：</p>
                    <p>{{ currentPlan.auditComment }}</p>
                </div>

                <template #footer>
                    <el-button @click="auditVisible = false">取消</el-button>
                    <el-button type="primary" @click="submitAudit" v-if="!isViewMode">确认提交</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-training-config">
        <div>
            <div class="card-header">
                <h3>培训管理</h3>
            </div>

            <div class="filter-container" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div style="display: flex; gap: 10px;">
                    <el-input v-model="searchKeyword" placeholder="培训营/计划名称" style="width: 200px;" clearable></el-input>
                    <el-date-picker v-model="filterDateRange" type="daterange" range-separator="至" start-placeholder="开始日期" end-placeholder="结束日期" value-format="YYYY-MM-DD" style="width: 240px;"></el-date-picker>
                    <el-button type="primary" @click="handleSearch">查询</el-button>
                </div>
                <el-button type="primary" @click="handleCreate">新建培训营</el-button>
            </div>
            
            <div class="section-title">培训营列表（可为每个培训营配置课程）</div>
            <el-table :data="filteredTableData" border style="width: 100%">
                <el-table-column label="培训营名称" min-width="150">
                    <template #default="scope">
                        <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleDetail(scope.row)">{{ scope.row.campName }}</span>
                    </template>
                </el-table-column>
                <el-table-column prop="school" label="学校名称" width="150"></el-table-column>
                <el-table-column label="报名/总(人数)" width="150">
                    <template #default="scope">
                        <el-tooltip content="点击查看报名情况" placement="top">
                            <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleToStudent(scope.row)">
                                {{ scope.row.enrolled }}/{{ scope.row.headcount }}
                            </span>
                        </el-tooltip>
                    </template>
                </el-table-column>
                <el-table-column label="培训周期" width="220">
                    <template #default="scope">{{ scope.row.startDate }} ~ {{ scope.row.endDate }}</template>
                </el-table-column>
                <el-table-column prop="status" label="状态" width="100">
                    <template #default="scope">
                        <el-tag :type="getStatusType(scope.row.status)">{{ getStatusLabel(scope.row.status) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="课程数" width="100">
                    <template #default="scope">
                        {{ (scope.row.courses || []).length }}
                    </template>
                </el-table-column>
                <el-table-column label="操作" width="180">
                    <template #default="scope">
                         <el-dropdown trigger="click">
                             <el-button size="small">更多</el-button>
                             <template #dropdown>
                                 <el-dropdown-menu>
                                     <el-dropdown-item v-if="scope.row.status === 'Pending'" @click="handleStart(scope.row)">启动</el-dropdown-item>
                                     <el-dropdown-item @click="handleEdit(scope.row)">修改</el-dropdown-item>
                                     <el-dropdown-item @click="handleConfigCourses(scope.row)">配置课程</el-dropdown-item>
                                     <el-dropdown-item @click="handleConfirm(scope.row)">确认名单</el-dropdown-item>
                                     <el-dropdown-item divided @click="handleDelete(scope.row)">删除</el-dropdown-item>
                                 </el-dropdown-menu>
                             </template>
                         </el-dropdown>
                    </template>
                </el-table-column>
            </el-table>

            <!-- Config Dialog -->
            <el-dialog v-model="dialogVisible" :title="dialogTitle" width="50%">
                <el-form :model="form" :rules="rules" ref="formRef" label-width="120px" :disabled="isViewMode">
                    <el-form-item label="选择计划" prop="planIds" v-if="!isViewMode">
                        <el-select v-model="form.planIds" multiple placeholder="请选择已审核通过的计划" style="width: 100%" @change="onPlanChange">
                            <el-option v-for="plan in approvedPlans" :key="plan.id" :label="plan.planName + ' (剩余:' + plan.remainingHeadcount + ')'" :value="plan.id"></el-option>
                        </el-select>
                    </el-form-item>
                    <div v-if="isViewMode" style="margin-bottom: 20px;">
                        <div class="section-title" style="margin-top: 0;">关联计划信息</div>
                        <el-descriptions :column="2" border>
                            <el-descriptions-item label="计划名称">{{ currentPlanInfo.planName }}</el-descriptions-item>
                            <el-descriptions-item label="企业名称">{{ currentPlanInfo.enterprise }}</el-descriptions-item>
                            <el-descriptions-item label="计划周期">{{ currentPlanInfo.startDate }} ~ {{ currentPlanInfo.endDate }}</el-descriptions-item>
                            <el-descriptions-item label="需求人数">{{ currentPlanInfo.headcount }}人</el-descriptions-item>
                            <el-descriptions-item label="岗位类型">{{ currentPlanInfo.positionType }}</el-descriptions-item>
                            <el-descriptions-item label="培训地点">{{ currentPlanInfo.location }}</el-descriptions-item>
                            <el-descriptions-item label="预算费用">{{ currentPlanInfo.budget }}</el-descriptions-item>
                            <el-descriptions-item label="学历要求">{{ currentPlanInfo.education }}</el-descriptions-item>
                            <el-descriptions-item label="专业要求" :span="2">{{ currentPlanInfo.major }}</el-descriptions-item>
                            <el-descriptions-item label="技能要求" :span="2">{{ currentPlanInfo.skills }}</el-descriptions-item>
                            <el-descriptions-item label="备注" :span="2">{{ currentPlanInfo.remark }}</el-descriptions-item>
                        </el-descriptions>
                    </div>
                    
                    <div class="section-title" v-if="isViewMode">培训营信息</div>
                    <el-form-item label="分配学校" prop="school">
                        <el-select v-model="form.school" placeholder="请选择合作学校" style="width: 100%">
                            <el-option v-for="school in schools" :key="school" :label="school" :value="school"></el-option>
                        </el-select>
                    </el-form-item>
                    <el-form-item label="培训营名称" prop="campName">
                        <el-input v-model="form.campName" placeholder="自动生成，可修改"></el-input>
                    </el-form-item>
                    <el-form-item label="报名&分配人数" prop="headcount">
                        <el-input-number v-model="form.headcount" :min="1" style="width: 100%"></el-input-number>
                    </el-form-item>
                    <el-form-item label="培训时间" prop="dateRange">
                        <el-date-picker v-model="form.dateRange" type="daterange" range-separator="至" start-placeholder="开始日期" end-placeholder="结束日期" value-format="YYYY-MM-DD" style="width: 100%"></el-date-picker>
                    </el-form-item>
                    <div v-if="isViewMode && (currentCampCourses && currentCampCourses.length)" class="section-title">课程明细（课程 + 时间 + 地点）</div>
                    <el-timeline v-if="isViewMode && (currentCampCourses && currentCampCourses.length)">
                        <el-timeline-item
                            v-for="item in currentCampCourses"
                            :key="item.courseId"
                            :timestamp="item.schedule"
                            placement="top"
                        >
                            <div style="font-weight: 500; margin-bottom: 4px;">{{ item.name }}</div>
                            <div style="color: #909399; font-size: 12px; margin-top: 4px;">
                                时间：{{ item.schedule }} ｜ 地点：{{ item.location }}
                            </div>
                        </el-timeline-item>
                    </el-timeline>
                    <div
                        v-if="isViewMode && (!currentCampCourses || !currentCampCourses.length)"
                        style="margin: 10px 0; color: #909399;"
                    >
                        当前培训营暂未配置课程，请在列表中通过“更多 → 配置课程”为该培训营添加课程。
                    </div>
                    
                    <div class="section-title">考核目标配置</div>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="达标分数线" prop="passScoreThreshold">
                                <el-input-number v-model="form.passScoreThreshold" :min="0" :max="100" style="width: 100%"></el-input-number>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="目标达标率(%)" prop="targetPassRate">
                                <el-input-number v-model="form.targetPassRate" :min="0" :max="100" style="width: 100%"></el-input-number>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <el-row :gutter="20">
                        <el-col :span="12">
                            <el-form-item label="必修课时数" prop="requiredLessons">
                                <el-input-number v-model="form.requiredLessons" :min="0" :max="1000" style="width: 100%"></el-input-number>
                            </el-form-item>
                        </el-col>
                        <el-col :span="12">
                            <el-form-item label="评分权重(出勤/考核评分)">
                                <div style="display:flex;gap:8px;">
                                    <el-input-number v-model="form.attendanceWeight" :min="0" :max="100"></el-input-number>
                                    <el-input-number v-model="form.reviewWeight" :min="0" :max="100"></el-input-number>
                                </div>
                            </el-form-item>
                        </el-col>
                    </el-row>
                    <div class="section-title">成就徽章配置</div>
                    <el-form-item label="徽章列表">
                        <div style="width: 100%;">
                            <el-button type="primary" link @click="addBadge">新增徽章</el-button>
                            <div v-if="!form.badges || !form.badges.length" style="margin-top: 8px; color: #909399;">
                                暂无徽章，可点击“新增徽章”添加。
                            </div>
                            <div
                                v-for="(badge, index) in form.badges"
                                :key="badge.id"
                                style="margin-top: 10px; display: flex; align-items: center; gap: 10px;"
                            >
                                <el-input
                                    v-model="badge.name"
                                    placeholder="成就名称，如“全勤之星”"
                                    style="flex: 1;"
                                ></el-input>
                                <el-upload
                                    :show-file-list="false"
                                    :before-upload="file => handleBadgeIconBeforeUpload(file, index)"
                                >
                                    <el-button size="small">上传图标</el-button>
                                </el-upload>
                                <div
                                    v-if="badge.iconUrl"
                                    style="width: 32px; height: 32px; border-radius: 50%; overflow: hidden; border: 1px solid #e4e7ed; display: flex; align-items: center; justify-content: center;"
                                >
                                    <img :src="badge.iconUrl" style="max-width: 100%; max-height: 100%;" />
                                </div>
                                <el-button type="danger" link @click="removeBadge(index)">删除</el-button>
                            </div>
                        </div>
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="dialogVisible = false">{{ isViewMode ? '关闭' : '取消' }}</el-button>
                    <el-button type="primary" @click="submitForm" v-if="!isViewMode">保存配置</el-button>
                </template>
            </el-dialog>

            <!-- QR Code Dialog -->
            <el-dialog v-model="qrVisible" title="签到二维码" width="300px" center>
                <div style="text-align: center;">
                    <p style="font-weight: bold; margin-bottom: 10px;">{{ currentCamp.campName }}</p>
                    <div style="background: #f0f2f5; width: 200px; height: 200px; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: #909399;">
                        [ 模拟二维码图片 ]
                    </div>
                    <p style="margin-top: 10px; color: #666;">请下载或打印此二维码用于学生签到</p>
                </div>
                <template #footer>
                    <el-button type="primary" style="width: 100%">下载图片</el-button>
                </template>
            </el-dialog>

            <el-dialog v-model="courseConfigVisible" title="配置培训课程" width="60%">
                <div style="margin-bottom: 10px;">
                    当前培训营：{{ courseConfigCamp && courseConfigCamp.campName ? courseConfigCamp.campName : '' }}
                </div>
                <div style="margin-bottom: 10px; color: #909399;">
                    勾选课程，并为每门课填写上课时间和地点，即为当前培训营新增课程。
                    如需新增课程，请先在“课程管理”页面创建。
                </div>

                <div class="section-title" style="margin-top: 5px;">已选课程课表</div>
                <el-table :data="selectedCourseConfigList" border style="width: 100%; margin-bottom: 10px;">
                    <el-table-column prop="name" label="课程名称" min-width="200" />
                    <el-table-column label="上课时间" width="220">
                        <template #default="scope">
                            <el-date-picker
                                v-model="scope.row.schedule"
                                type="datetime"
                                value-format="YYYY-MM-DD HH:mm"
                                placeholder="选择时间"
                                style="width: 100%;"
                            />
                        </template>
                    </el-table-column>
                    <el-table-column label="上课地点" width="220">
                        <template #default="scope">
                            <el-input v-model="scope.row.location" placeholder="请输入地点" />
                        </template>
                    </el-table-column>
                </el-table>
                <div v-if="selectedCourseConfigList.length === 0" style="margin-bottom: 10px; color: #909399;">
                    暂未选择课程，请在下方课程池中勾选需要的课程。
                </div>

                <div class="section-title" style="margin-top: 10px;">课程池（勾选添加课程）</div>
                <div style="display:flex;gap:10px;margin-bottom:10px;">
                    <el-input
                        v-model="courseFilterKeyword"
                        placeholder="按课程名称搜索"
                        clearable
                        style="width:260px;"
                    ></el-input>
                </div>
                <el-table :data="filteredCoursePoolList" border style="width: 100%; margin-bottom: 10px;">
                    <el-table-column label="" width="60">
                        <template #default="scope">
                            <el-checkbox v-model="scope.row.selected" />
                        </template>
                    </el-table-column>
                    <el-table-column prop="name" label="课程名称" min-width="200" />
                </el-table>
                <template #footer>
                    <el-button @click="courseConfigVisible = false">取消</el-button>
                    <el-button type="primary" @click="saveCourseConfig">保存</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-student-management-op">
        <div>
            <div class="card-header"><h3>学生管理 (运营)</h3></div>
            <el-tabs type="card" v-model="activeSubTab">
                <el-tab-pane label="平台初筛" name="screening">
                     <div class="filter-container">
                         <el-input v-model="filterCamp" placeholder="培训营名称" style="width: 200px; margin-right: 10px;" clearable></el-input>
                         <el-input placeholder="姓名/学校" style="width: 200px;"></el-input>
                         <el-select placeholder="初筛状态" style="width: 120px;">
                             <el-option label="待筛选" value="Pending"></el-option>
                             <el-option label="已通过" value="Passed"></el-option>
                             <el-option label="已淘汰" value="Rejected"></el-option>
                         </el-select>
                         <el-button type="primary">查询</el-button>
                         <div style="flex: 1; text-align: right;">
                             <el-button type="success" @click="batchScreen('Passed')">批量通过</el-button>
                             <el-button type="danger" @click="batchScreen('Rejected')">批量淘汰</el-button>
                         </div>
                     </div>
                     <el-table :data="filteredScreeningList" border @selection-change="handleSelectionChange">
                         <el-table-column type="selection" width="55"></el-table-column>
                         <el-table-column prop="name" label="姓名" width="100"></el-table-column>
                         <el-table-column prop="school" label="学校" width="150"></el-table-column>
                         <el-table-column prop="major" label="专业" width="150"></el-table-column>
                         <el-table-column prop="camp" label="申请培训营"></el-table-column>
                         <el-table-column prop="match" label="匹配度" width="80"></el-table-column>
                         <el-table-column prop="status" label="初筛状态" width="100">
                             <template #default="scope">
                                 <el-tag :type="getScreenStatusType(scope.row.status)">{{ getScreenStatusLabel(scope.row.status) }}</el-tag>
                             </template>
                         </el-table-column>
                         <el-table-column label="操作">
                             <template #default="scope">
                                 <el-button size="small" type="success" @click="updateScreenStatus(scope.row, 'Passed')">通过</el-button>
                                 <el-button size="small" type="danger" @click="updateScreenStatus(scope.row, 'Rejected')">淘汰</el-button>
                                 <el-button size="small" link>详情</el-button>
                             </template>
                         </el-table-column>
                     </el-table>
                </el-tab-pane>

                <el-tab-pane label="培训考勤" name="attendance">
                    <training-monitoring></training-monitoring>
                </el-tab-pane>
            </el-tabs>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-course-management-op">
        <div>
            <div class="card-header"><h3>课程管理 (运营)</h3></div>
            <div class="filter-container" style="display:flex;gap:10px;align-items:center;">
                <el-button type="primary" @click="openCreate">新建课程</el-button>
            </div>
            
            <div class="section-title">课程列表</div>
            <el-table :data="courseList" border style="width: 100%">
                <el-table-column prop="name" label="课程名称" min-width="160"></el-table-column>
                <el-table-column prop="content" label="课程内容" min-width="260"></el-table-column>
                <el-table-column prop="teacher" label="讲师" width="120"></el-table-column>
                <el-table-column label="操作" width="180" fixed="right">
                    <template #default="scope">
                        <el-button size="small" @click="openEdit(scope.row)">编辑</el-button>
                        <el-button
                            size="small"
                            type="danger"
                            @click="removeCourse(scope.row)"
                        >删除课程</el-button>
                    </template>
                </el-table-column>
            </el-table>

            <el-dialog v-model="dialogVisible" :title="dialogTitle" width="40%">
                <el-form :model="form" label-width="100px" ref="formRef" :rules="rules">
                    <el-form-item label="课程名称" prop="name">
                        <el-input v-model="form.name" placeholder="请输入课程名称"></el-input>
                    </el-form-item>
                    <el-form-item label="课程内容" prop="content">
                        <el-input v-model="form.content" type="textarea" placeholder="请输入课程主要内容"></el-input>
                    </el-form-item>
                    <el-form-item label="讲师" prop="teacher">
                        <el-input v-model="form.teacher" placeholder="请输入讲师姓名"></el-input>
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="dialogVisible = false">取消</el-button>
                    <el-button type="primary" @click="submitForm">保存</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-settlement-management">
        <div>
            <div class="card-header"><h3>结算管理</h3></div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="id" label="结算单号"></el-table-column>
                <el-table-column prop="enterprise" label="企业名称"></el-table-column>
                <el-table-column prop="camp" label="培训营"></el-table-column>
                <el-table-column prop="amount" label="结算金额"></el-table-column>
                <el-table-column prop="status" label="状态">
                     <template #default="scope">
                        <el-tag :type="scope.row.status === 'Paid' ? 'success' : 'warning'">{{ scope.row.status }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" v-if="scope.row.status === 'Pending'" type="primary">生成结算单</el-button>
                        <el-button size="small" v-if="scope.row.status === 'Confirmed'" type="success">确认支付</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-operation-layout">
        <el-card>
            <plan-audit v-if="opStore.activeTab === 'audit'"></plan-audit>
            <training-config v-if="opStore.activeTab === 'config'"></training-config>
            <course-management-op v-if="opStore.activeTab === 'courses'"></course-management-op>
            <student-management-op v-if="opStore.activeTab === 'student'"></student-management-op>
            <settlement-management v-if="opStore.activeTab === 'settlement'"></settlement-management>
        </el-card>
    </script>

    <!-- ================= 3. SCHOOL TEMPLATES ================= -->
    <script type="text/x-template" id="tmpl-school-training">
        <div>
            <div class="card-header"><h3>培训管理</h3></div>
            <div class="filter-container">
                <el-input placeholder="计划/企业名称" style="width: 200px;"></el-input>
                <el-select placeholder="状态" style="width: 120px;">
                    <el-option label="待确认" value="Assigned"></el-option>
                    <el-option label="招募中" value="Publishing"></el-option>
                    <el-option label="报名截止" value="Closed"></el-option>
                    <el-option label="未开始" value="NotStarted"></el-option>
                    <el-option label="进行中" value="Training"></el-option>
                    <el-option label="已结束" value="Finished"></el-option>
                </el-select>
                <el-button type="primary">查询</el-button>
            </div>
            
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column label="培训营名称" min-width="150">
                    <template #default="scope">
                        <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleDetail(scope.row)">{{ scope.row.planName }}</span>
                    </template>
                </el-table-column>
                <el-table-column prop="enterprise" label="企业名称" width="150"></el-table-column>
                <el-table-column prop="positionType" label="岗位类型" width="120"></el-table-column>
                <el-table-column label="报名/总(人数)" width="150">
                    <template #default="scope">
                        <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleViewStudents(scope.row)">
                            {{ scope.row.enrolled || 0 }}/{{ scope.row.headcount }}
                        </span>
                    </template>
                </el-table-column>
                <el-table-column label="培训周期" width="200">
                    <template #default="scope">{{ scope.row.period }}</template>
                </el-table-column>
                <el-table-column prop="status" label="状态" width="120">
                    <template #default="scope">
                        <el-tag :type="getStatusType(scope.row.status)">{{ getStatusLabel(scope.row.status) }}</el-tag>
                    </template>
                </el-table-column>
                <el-table-column label="操作" width="160" fixed="right">
                    <template #default="scope">
                        <el-dropdown>
                            <el-button size="small" type="primary">
                                操作
                                <i class="el-icon-arrow-down el-icon--right"></i>
                            </el-button>
                            <template #dropdown>
                                <el-dropdown-menu>
                                    <el-dropdown-item @click="handleDetail(scope.row)">查看详情</el-dropdown-item>
                                    <el-dropdown-item v-if="scope.row.status === 'Assigned'" @click="handleConfirm(scope.row)">接收</el-dropdown-item>
                                    <el-dropdown-item v-if="scope.row.status === 'Assigned'" @click="handleReject(scope.row)">拒绝</el-dropdown-item>
                                    <el-dropdown-item v-if="['Confirmed', 'Publishing', 'Registering'].includes(scope.row.status)" @click="handlePublish(scope.row)">{{ ['Publishing', 'Registering'].includes(scope.row.status) ? '编辑招募' : '发布招募' }}</el-dropdown-item>
                                    <el-dropdown-item v-if="['Publishing', 'Registering'].includes(scope.row.status)" @click="handleCancelPublish(scope.row)">撤销招募</el-dropdown-item>
                                    <el-dropdown-item v-if="['Publishing', 'Registering', 'Closed'].includes(scope.row.status)" @click="handleViewLogs(scope.row)">招募记录</el-dropdown-item>
                                </el-dropdown-menu>
                            </template>
                        </el-dropdown>
                    </template>
                </el-table-column>
            </el-table>

            <!-- Plan Detail Dialog -->
            <el-dialog v-model="detailVisible" title="计划详情" width="50%">
                <div>
                    <table class="detail-table" style="width: 100%; border-collapse: collapse; border: 1px solid #EBEEF5;">
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5; width: 120px;">计划名称</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.planName }}</td>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5; width: 120px;">企业名称</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.enterprise }}</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">计划周期</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.period }}</td>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">报名/需求</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.enrolled || 0 }}/{{ currentPlanDetail.headcount }}人</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">岗位类型</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.positionType }}</td>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">培训地点</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.location }}</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">预算费用</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.budget }}</td>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">学历要求</td>
                            <td class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.education }}</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">专业要求</td>
                            <td colspan="3" class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.major }}</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">技能要求</td>
                            <td colspan="3" class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.skills }}</td>
                        </tr>
                        <tr>
                            <td class="label" style="background: #FAFAFA; padding: 10px; font-weight: bold; border: 1px solid #EBEEF5;">备注</td>
                            <td colspan="3" class="content" style="padding: 10px; border: 1px solid #EBEEF5;">{{ currentPlanDetail.remark }}</td>
                        </tr>
                    </table>
                </div>
                <template #footer>
                    <el-button @click="detailVisible = false">关闭</el-button>
                </template>
            </el-dialog>

            <!-- Publish Dialog -->
            <el-dialog v-model="publishVisible" title="发布招募信息" width="50%">
                <el-form :model="publishForm" label-width="100px">
                    <el-form-item label="招募标题">
                        <el-input v-model="publishForm.title" placeholder="请输入招募标题"></el-input>
                    </el-form-item>
                    <el-form-item label="招募内容">
                        <div style="border: 1px solid #dcdfe6; border-radius: 4px;">
                            <div style="background-color: #f5f7fa; padding: 5px 10px; border-bottom: 1px solid #dcdfe6;">
                                <el-button size="small" icon="el-icon-edit">B</el-button>
                                <el-button size="small" icon="el-icon-edit">I</el-button>
                                <el-button size="small" icon="el-icon-edit">U</el-button>
                                <el-button size="small" icon="el-icon-picture">图片</el-button>
                                <el-button size="small" icon="el-icon-link">链接</el-button>
                            </div>
                            <el-input type="textarea" :rows="6" v-model="publishForm.content" placeholder="请输入招募详细信息..." style="border: none; box-shadow: none;"></el-input>
                        </div>
                    </el-form-item>
                    <el-form-item label="截止时间">
                        <el-date-picker v-model="publishForm.deadline" type="datetime" placeholder="请选择报名截止时间" style="width: 100%"></el-date-picker>
                    </el-form-item>
                    <el-form-item label="发布状态">
                        <el-radio-group v-model="publishForm.publishType">
                            <el-radio label="Now">立即发布</el-radio>
                            <el-radio label="Scheduled">定时发布</el-radio>
                        </el-radio-group>
                    </el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="publishVisible = false">取消</el-button>
                    <el-button type="primary" @click="confirmPublish">确认发布</el-button>
                </template>
            </el-dialog>

            <!-- Students List Dialog -->
            <el-dialog v-model="studentsVisible" title="报名情况" width="60%">
                <div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <span><strong>{{ currentPlan.planName }}</strong> - 报名人数：<span style="color: #409EFF; font-weight: bold;">{{ studentList.length }}</span></span>
                    <el-button type="primary" plain size="small">导出名单</el-button>
                </div>
                <el-table :data="studentList" border height="400">
                    <el-table-column type="index" label="序号" width="60"></el-table-column>
                    <el-table-column prop="name" label="学生姓名" width="120"></el-table-column>
                    <el-table-column prop="school" label="学校" width="150"></el-table-column>
                    <el-table-column prop="major" label="专业" width="150"></el-table-column>
                    <el-table-column prop="applyTime" label="报名时间"></el-table-column>
                    <el-table-column label="简历">
                        <template #default="scope"><el-button link type="primary">查看</el-button></template>
                    </el-table-column>
                </el-table>
            </el-dialog>
            
            <!-- Recruit Logs Dialog -->
            <el-dialog v-model="logsVisible" title="招募记录" width="50%">
                <el-table :data="currentLogs" border style="width: 100%">
                    <el-table-column prop="action" label="操作" width="120"></el-table-column>
                    <el-table-column prop="operator" label="操作人" width="120"></el-table-column>
                    <el-table-column prop="time" label="操作时间" width="180"></el-table-column>
                    <el-table-column prop="content" label="操作内容"></el-table-column>
                </el-table>
                <template #footer>
                    <el-button @click="logsVisible = false">关闭</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-school-attendance">
        <div>
            <div class="card-header">
                <h3>考勤管理</h3>
                <el-button type="primary" @click="createCourse">创建培训课程</el-button>
            </div>
            
            <div class="section-title">课程列表</div>
            <el-table :data="courses" border style="width: 100%">
                <el-table-column prop="name" label="课程名称"></el-table-column>
                <el-table-column prop="time" label="时间"></el-table-column>
                <el-table-column prop="location" label="地点"></el-table-column>
                <el-table-column prop="signed" label="签到/总数"></el-table-column>
                <el-table-column label="操作">
                    <template #default="scope">
                        <el-button size="small" link @click="handleDetail(scope.row)">详情</el-button>
                    </template>
                </el-table-column>
            </el-table>

            <el-dialog v-model="dialogVisible" title="创建培训课程" width="30%">
                <el-form :model="form" label-width="80px">
                    <el-form-item label="课程名称">
                        <el-input v-model="form.name" placeholder="请输入课程名称"></el-input>
                    </el-form-item>
                    <el-form-item label="时间">
                        <el-date-picker v-model="form.time" type="datetime" placeholder="选择时间" value-format="YYYY-MM-DD HH:mm" style="width: 100%"></el-date-picker>
                    </el-form-item>
                    <el-form-item label="地点">
                        <el-input v-model="form.location" placeholder="请输入上课地点"></el-input>
                    </el-form-item>
                </el-form>
                <template #footer>
                    <span class="dialog-footer">
                        <el-button @click="dialogVisible = false">取消</el-button>
                        <el-button type="primary" @click="handleSubmit">确定</el-button>
                    </span>
                </template>
            </el-dialog>

            <el-dialog v-model="detailVisible" title="课程详情" width="50%">
                <el-descriptions :column="2" border v-if="currentCourse">
                    <el-descriptions-item label="课程名称">{{ currentCourse.name }}</el-descriptions-item>
                    <el-descriptions-item label="上课时间">{{ currentCourse.time }}</el-descriptions-item>
                    <el-descriptions-item label="上课地点">{{ currentCourse.location }}</el-descriptions-item>
                    <el-descriptions-item label="签到情况">{{ currentCourse.signed }}</el-descriptions-item>
                </el-descriptions>
                
                <div class="section-title" style="margin-top: 20px;">签到学生名单</div>
                <el-table :data="attendanceList" border style="width: 100%; margin-top: 10px;">
                    <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                    <el-table-column prop="school" label="学校"></el-table-column>
                    <el-table-column prop="status" label="状态" width="100">
                        <template #default="scope">
                            <el-tag :type="scope.row.status === 'Present' ? 'success' : 'danger'">
                                {{ scope.row.status === 'Present' ? '已签到' : '未签到' }}
                            </el-tag>
                        </template>
                    </el-table-column>
                    <el-table-column prop="time" label="签到时间"></el-table-column>
                </el-table>
                <template #footer>
                    <span class="dialog-footer">
                        <el-button @click="detailVisible = false">关闭</el-button>
                    </span>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-school-assessment">
        <div>
            <div class="card-header">
                <h3>考核结果</h3>
                <div class="filter-container">
                    <el-select v-model="selectedCamp" placeholder="选择培训营" style="width: 200px;">
                        <el-option label="Java后端-一期(北大)" value="1"></el-option>
                    </el-select>
                    <el-button type="primary">查询</el-button>
                    <el-button type="success" @click="batchInput">批量录入</el-button>
                </div>
            </div>
            
            <el-row :gutter="20" style="margin-bottom: 20px;">
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ stats.total }}</h3><p>参训总人数</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ stats.qualified }}</h3><p>达标人数</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3 style="color:green">{{ stats.rate }}%</h3><p>达标率</p></div></el-card></el-col>
                <el-col :span="6"><el-card shadow="hover"><div style="text-align:center"><h3>{{ stats.avgScore }}</h3><p>平均成绩</p></div></el-card></el-col>
            </el-row>
            <el-row :gutter="20" style="margin-bottom: 20px;">
                <el-col :span="8"><el-card shadow="hover"><div style="text-align:center"><h3>{{ campGoals.targetPassRate }}%</h3><p>目标达标率</p></div></el-card></el-col>
                <el-col :span="8"><el-card shadow="hover"><div style="text-align:center"><h3>{{ campGoals.passScoreThreshold }}</h3><p>达标分数线</p></div></el-card></el-col>
                <el-col :span="8"><el-card shadow="hover"><div style="text-align:center"><h3 :style="{color: Number(stats.rate) >= campGoals.targetPassRate ? 'green' : 'red'}">{{ Number(stats.rate) >= campGoals.targetPassRate ? '已达成' : '未达成' }}</h3><p>达标率目标对比</p></div></el-card></el-col>
            </el-row>

            <div ref="chartDom" style="width: 100%; height: 300px; margin-bottom: 20px;"></div>

            <div class="section-title">考核录入</div>
            <el-table :data="tableData" border style="width: 100%">
                <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                <el-table-column prop="school" label="学校"></el-table-column>
                <el-table-column prop="major" label="专业"></el-table-column>
                <el-table-column label="考核成绩(0-100)" width="200">
                    <template #default="scope">
                        <el-input-number v-model="scope.row.score" :min="0" :max="100" size="small" @change="onScoreChange(scope.row)"></el-input-number>
                    </template>
                </el-table-column>
                <el-table-column label="是否达标" width="150">
                     <template #default="scope">
                         <el-switch v-model="scope.row.isQualified" active-text="达标" inactive-text="不达标"></el-switch>
                     </template>
                </el-table-column>
                <el-table-column label="操作">
                    <template #default="scope"><el-button size="small" type="primary" @click="saveRow(scope.row)">保存</el-button></template>
                </el-table-column>
            </el-table>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-school-layout">
        <el-card>
            <school-training v-if="activeTab === 'training'"></school-training>
            <training-monitoring v-if="activeTab === 'attendance'"></training-monitoring>
            <school-assessment v-if="activeTab === 'assessment'"></school-assessment>
        </el-card>
    </script>

    <!-- ================= 4. STUDENT TEMPLATES ================= -->
    <script type="text/x-template" id="tmpl-student-registration">
        <div class="student-app-page">
            <div class="student-app-header">
                <div class="student-app-title">培训报名</div>
                <div class="student-app-subtitle">为你推荐适合的实训营</div>
            </div>
            <div class="student-app-search">
                <el-input placeholder="搜索培训/企业/城市" clearable>
                    <template #prefix>
                        <el-icon><Search /></el-icon>
                    </template>
                </el-input>
            </div>
            <div class="student-app-card-list">
                <div class="student-app-card" v-for="plan in plans" :key="plan.id">
                    <div class="student-app-card-main">
                        <div class="student-app-card-title-row">
                            <div class="student-app-card-title">{{ plan.name }}</div>
                            <el-tag :type="plan.status === 'Open' ? 'success' : 'info'" size="small">{{ plan.status === 'Open' ? '报名中' : '已截止' }}</el-tag>
                        </div>
                        <div class="student-app-card-meta">{{ plan.company }} · {{ plan.position }} · {{ plan.location }}</div>
                        <div class="student-app-card-meta">周期 {{ plan.period }}</div>
                        <div class="student-app-card-progress">
                            <div class="student-app-card-progress-text">报名 {{ plan.enrolled }}/{{ plan.headcount }}</div>
                        </div>
                    </div>
                    <div class="student-app-card-footer">
                        <el-button type="primary" size="small" round :disabled="plan.status !== 'Open'" @click="openEnroll(plan)">立即报名</el-button>
                    </div>
                </div>
            </div>

            <el-dialog v-model="enrollVisible" title="在线报名" width="90%" align-center>
                <el-form label-width="80px">
                    <el-form-item label="姓名"><el-input v-model="enrollForm.name"></el-input></el-form-item>
                    <el-form-item label="学校"><el-input v-model="enrollForm.school"></el-input></el-form-item>
                    <el-form-item label="简历"><el-button icon="Upload">上传简历文件</el-button></el-form-item>
                    <el-form-item label="简介"><el-input type="textarea" v-model="enrollForm.intro"></el-input></el-form-item>
                </el-form>
                <template #footer>
                    <el-button @click="enrollVisible = false">取消</el-button>
                    <el-button type="primary" @click="confirmEnroll">提交报名</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-student-mytraining">
        <div class="student-app-page">
            <div class="student-app-header">
                <div class="student-app-title">我的培训</div>
                <div class="student-app-subtitle">查看报名进度与上课安排</div>
            </div>
            <el-tabs v-model="activeSubTab" class="student-app-tabs">
                <el-tab-pane label="报名状态" name="status">
                    <el-table :data="myPlans" border>
                        <el-table-column prop="name" label="培训名称"></el-table-column>
                        <el-table-column prop="company" label="企业名称"></el-table-column>
                        <el-table-column prop="applyTime" label="报名时间"></el-table-column>
                        <el-table-column prop="status" label="审核状态">
                            <template #default="scope">
                                <el-tag :type="getStatusType(scope.row.status)">{{ getStatusLabel(scope.row.status) }}</el-tag>
                            </template>
                        </el-table-column>
                        <el-table-column label="操作">
                            <template #default="scope">
                                <el-button size="small" v-if="scope.row.status === 'Passed'" @click="viewSchedule(scope.row)">查看安排</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </el-tab-pane>

                <el-tab-pane label="培训安排" name="schedule" :disabled="!currentTraining">
                    <div v-if="currentTraining">
                        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 16px; font-weight: bold;">{{ currentTraining.name }} - 课程表</span>
                            <el-button type="primary" size="large" icon="FullScreen" @click="handleScan">扫码签到</el-button>
                        </div>
                        
                        <el-table :data="scheduleList" border>
                            <el-table-column prop="date" label="日期" width="120"></el-table-column>
                            <el-table-column prop="time" label="时间" width="120"></el-table-column>
                            <el-table-column prop="location" label="地点" width="150"></el-table-column>
                            <el-table-column prop="topic" label="主题"></el-table-column>
                            <el-table-column prop="signed" label="签到/总数" width="120">
                                <template #default="scope">
                                    <span style="color: #409EFF; cursor: pointer; text-decoration: underline;" @click="handleDetail(scope.row)">{{ scope.row.signed }}</span>
                                </template>
                            </el-table-column>
                            <el-table-column prop="attendance" label="出勤状态" width="100">
                                <template #default="scope">
                                    <el-tag :type="getAttendanceType(scope.row.attendance)">{{ getAttendanceLabel(scope.row.attendance) }}</el-tag>
                                </template>
                            </el-table-column>
                        </el-table>
                    </div>
                    <div v-else style="text-align: center; color: #909399; padding: 40px;">
                        请先在“报名状态”中选择一个已通过的培训查看安排
                    </div>
                </el-tab-pane>
            </el-tabs>

            <!-- Detail Dialog -->
            <el-dialog v-model="detailVisible" title="签到详情" width="50%">
                <div v-if="currentDetail">
                    <p><strong>课程:</strong> {{ currentDetail.topic }}</p>
                    <p><strong>时间:</strong> {{ currentDetail.date }} {{ currentDetail.time }}</p>
                    <p><strong>签到情况:</strong> {{ currentDetail.signed }}</p>
                    <el-divider></el-divider>
                    <p>这里展示签到学生列表（Mock数据）...</p>
                    <el-table :data="detailStudentList" border style="width: 100%; margin-top: 10px;">
                        <el-table-column prop="name" label="姓名" width="120"></el-table-column>
                        <el-table-column prop="school" label="学校"></el-table-column>
                        <el-table-column prop="status" label="状态" width="100">
                            <template #default="scope">
                                <el-tag :type="scope.row.status === 'Present' ? 'success' : 'danger'">
                                    {{ scope.row.status === 'Present' ? '已签到' : '未签到' }}
                                </el-tag>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
                <template #footer>
                    <el-button @click="detailVisible = false">关闭</el-button>
                </template>
            </el-dialog>

            <!-- Scan Dialog -->
            <el-dialog v-model="scanVisible" title="扫码签到" width="300px" center>
                <div style="text-align: center;">
                    <div style="background: #000; width: 200px; height: 200px; margin: 0 auto; display: flex; align-items: center; justify-content: center; color: #fff;">
                        [ 摄像头预览区域 ]
                    </div>
                    <p style="margin-top: 10px; color: #666;">请将摄像头对准教室前方的签到二维码</p>
                </div>
                <template #footer>
                    <el-button @click="scanVisible = false">取消</el-button>
                    <el-button type="success" @click="confirmScan">模拟扫码成功</el-button>
                </template>
            </el-dialog>
        </div>
    </script>

    <script type="text/x-template" id="tmpl-student-layout">
        <div class="student-app-shell">
            <div class="student-app-container">
                <div class="student-app-main">
                    <student-registration v-if="activeTab === 'registration'"></student-registration>
                    <student-mytraining v-if="activeTab === 'mytraining'"></student-mytraining>
                </div>
                <div class="student-app-tabbar">
                    <div class="student-app-tabbar-item" :class="{ active: activeTab === 'registration' }" @click="$router.push('/student?tab=registration')">
                        <div class="student-app-tabbar-icon">
                            <el-icon><Edit /></el-icon>
                        </div>
                        <div class="student-app-tabbar-text">报名</div>
                    </div>
                    <div class="student-app-tabbar-item" :class="{ active: activeTab === 'mytraining' }" @click="$router.push('/student?tab=mytraining')">
                        <div class="student-app-tabbar-icon">
                            <el-icon><Memo /></el-icon>
                        </div>
                        <div class="student-app-tabbar-text">我的</div>
                    </div>
                </div>
            </div>
        </div>
    </script>

    <script>
        const { createApp, ref, reactive, onMounted, computed } = Vue;
        const { createRouter, createWebHashHistory, useRoute, useRouter } = VueRouter;
        const { ElMessage, ElMessageBox } = ElementPlus;

        // ================= COMPONENT LOGIC =================

        // --- 1. Enterprise Logic ---
        const PlanManagement = {
            template: '#tmpl-plan-management',
            setup() {
                const loading = ref(false);
                const searchQuery = ref('');
                const filterStatus = ref('');
                const dialogVisible = ref(false);
                const dialogTitle = ref('创建计划');
                const isViewMode = ref(false);
                const formRef = ref(null);
                
                const positionTypes = ['技术类', '管理类', '营销类', '生产类', '服务类'];
                const provinceList = [
                    { value: 'Beijing', label: '北京' },
                    { value: 'Shanghai', label: '上海' },
                    { value: 'Guangdong', label: '广东' }
                ];
                const cityMap = {
                    'Beijing': [{ value: 'Beijing', label: '北京市' }],
                    'Shanghai': [{ value: 'Shanghai', label: '上海市' }],
                    'Guangdong': [{ value: 'Guangzhou', label: '广州市' }, { value: 'Shenzhen', label: '深圳市' }]
                };
                const getCityList = (province) => cityMap[province] || [];

                const tableData = ref([
                    { id: 101, planName: 'Java 全栈开发特训营', positionType: '技术类', headcount: 50, startDate: '2024-03-01', endDate: '2024-06-30', province: 'Beijing', city: 'Beijing', address: '海淀区中关村软件园二期', education: ['本科', '硕士'], budgetFee: 250000, settlementMethod: 'Phased', budgetDesc: '含教材费、讲师费', status: 'Published', submitTime: '2024-02-15', remark: '重点培养分布式系统架构设计能力。' },
                    { id: 102, planName: '产品经理精英训练营', positionType: '管理类', headcount: 30, startDate: '2024-04-01', endDate: '2024-05-01', province: 'Shanghai', city: 'Shanghai', address: '浦东新区陆家嘴', education: ['本科'], budgetFee: 120000, settlementMethod: 'Post', budgetDesc: '', status: 'Published', submitTime: '2024-03-01', remark: '培养产品思维。' },
                    { id: 103, planName: '大数据分析师培养计划', positionType: '技术类', headcount: 20, startDate: '2024-05-01', endDate: '2024-08-01', province: 'Guangdong', city: 'Shenzhen', address: '南山区科技园', education: ['本科'], budgetFee: 180000, settlementMethod: 'Post', budgetDesc: '含云资源使用费', remark: '草稿状态测试', status: 'Draft', submitTime: '' },
                    { id: 104, planName: '新媒体运营实习生', positionType: '营销类', headcount: 10, startDate: '2024-06-01', endDate: '2024-07-01', province: 'Beijing', city: 'Beijing', address: '朝阳区CBD', education: ['大专'], budgetFee: 50000, settlementMethod: 'Post', budgetDesc: '', remark: '驳回测试', status: 'Rejected', submitTime: '2024-03-10', auditComment: '预算过高，请重新调整', auditTime: '2024-03-11' }
                ]);

                const form = reactive({ 
                    id: null, planName: '', positionType: '', headcount: 0, 
                    dateRange: [], province: '', city: '', address: '',
                    education: [], major: '', skills: '', 
                    budgetFee: 0, settlementMethod: 'Post', budgetDesc: '',
                    remark: '', status: 'Draft', auditComment: '', auditTime: '', submitTime: ''
                });
                
                const rules = {
                    planName: [{ required: true, message: '必填', trigger: 'blur' }],
                    positionType: [{ required: true, message: '必选', trigger: 'change' }],
                    headcount: [{ required: true, message: '必填', trigger: 'blur' }],
                    dateRange: [{ required: true, message: '必填', trigger: 'change' }],
                    province: [{ required: true, message: '必选', trigger: 'change' }],
                    city: [{ required: true, message: '必选', trigger: 'change' }],
                    address: [{ required: true, message: '必填', trigger: 'blur' }],
                    education: [{ required: true, message: '至少选一项', trigger: 'change' }],
                    budgetFee: [{ required: true, message: '必填', trigger: 'blur' }],
                    settlementMethod: [{ required: true, message: '必选', trigger: 'change' }]
                };

                const getStatusLabel = (status) => {
                    const map = { 'Draft': '草稿', 'Pending': '待审核', 'Auditing': '审核中', 'Approved': '已通过', 'Rejected': '已驳回', 'Published': '已发布' };
                    return map[status] || status;
                };
                const getStatusType = (status) => {
                    const map = { 'Draft': 'info', 'Pending': 'warning', 'Auditing': 'primary', 'Approved': 'success', 'Rejected': 'danger', 'Published': 'success' };
                    return map[status] || '';
                };

                const resetForm = () => {
                     Object.assign(form, { 
                        id: null, planName: '', positionType: '', headcount: 0, 
                        dateRange: [], province: '', city: '', address: '',
                        education: [], major: '', skills: '', 
                        budgetFee: 0, settlementMethod: 'Post', budgetDesc: '',
                        remark: '', status: 'Draft', auditComment: '', auditTime: '', submitTime: ''
                    });
                };

                const handleConfirm = (row) => {
                    ElMessageBox.confirm('确认发送最终名单给企业吗?', '提示', { type: 'success' }).then(() => {
                        ElMessage.success('名单已发送');
                    });
                };

                const handleCreate = () => { 
                    dialogTitle.value = '创建计划'; 
                    isViewMode.value = false;
                    resetForm();
                    dialogVisible.value = true; 
                };
                
                const handleEdit = (row) => {
                    dialogTitle.value = '编辑计划'; 
                    isViewMode.value = false;
                    Object.assign(form, row); 
                    form.dateRange = [row.startDate, row.endDate];
                    dialogVisible.value = true; 
                };

                const handleDetail = (row) => {
                    dialogTitle.value = '计划详情';
                    isViewMode.value = true;
                    Object.assign(form, row);
                    form.dateRange = [row.startDate, row.endDate];
                    dialogVisible.value = true;
                };

                const handleSubmit = (row) => {
                    ElMessageBox.confirm('确定提交审核吗?', '提示').then(() => {
                        row.status = 'Pending';
                        row.submitTime = new Date().toISOString().split('T')[0];
                        ElMessage.success('已提交审核');
                    });
                };

                const submitForm = async () => {
                    if (!formRef.value) return;
                    await formRef.value.validate((valid) => {
                        if (valid) {
                            if (form.id) {
                                const idx = tableData.value.findIndex(item => item.id === form.id);
                                if (idx !== -1) {
                                    tableData.value[idx] = { 
                                        ...tableData.value[idx], ...form, 
                                        startDate: form.dateRange[0], endDate: form.dateRange[1], 
                                        status: form.status === 'Rejected' ? 'Pending' : form.status 
                                    };
                                    if(form.status === 'Rejected') {
                                        tableData.value[idx].submitTime = new Date().toISOString().split('T')[0];
                                    }
                                }
                            } else {
                                tableData.value.push({ 
                                    id: Date.now(), ...form, 
                                    startDate: form.dateRange[0], endDate: form.dateRange[1], 
                                    status: 'Draft', submitTime: '' 
                                });
                            }
                            dialogVisible.value = false;
                            ElMessage.success('保存成功');
                        }
                    });
                };
                
                const handleDelete = (row) => {
                     ElMessageBox.confirm('确定删除该计划吗?', '提示', { type: 'warning' }).then(() => {
                        tableData.value = tableData.value.filter(item => item.id !== row.id);
                        ElMessage.success('已删除');
                     });
                };
                const handleSearch = () => ElMessage.success('搜索已执行');

                return { loading, searchQuery, filterStatus, dialogVisible, dialogTitle, isViewMode, formRef, 
                         tableData, positionTypes, provinceList, getCityList, form, rules, 
                         getStatusLabel, getStatusType, handleCreate, handleEdit, handleDetail, handleSubmit, handleDelete, handleSearch, submitForm };
            }
        };

        const StudentScreening = {
            template: '#tmpl-student-screening',
            setup() {
                const filterPlan = ref('');
                const searchKeyword = ref('');
                const tableData = ref([
                    { id: 1, name: '张伟', school: '北京科技大学', major: '计算机科学与技术', education: '本科', matchRate: 92, platformStatus: 'Pass', enterpriseStatus: 'Pending' },
                    { id: 2, name: '李娜', school: '上海大学', major: '软件工程', education: '硕士', matchRate: 88, platformStatus: 'Pass', enterpriseStatus: 'Pending' },
                    { id: 3, name: '王强', school: '深圳大学', major: '电子信息', education: '本科', matchRate: 75, platformStatus: 'Pass', enterpriseStatus: 'Fail' },
                    { id: 4, name: '刘洋', school: '武汉理工大学', major: '通信工程', education: '本科', matchRate: 60, platformStatus: 'Fail', enterpriseStatus: 'Pending' }
                ]);
                const selectedRows = ref([]);
                const handleSelectionChange = (val) => selectedRows.value = val;
                const updateStatus = (row, status) => { row.enterpriseStatus = status; ElMessage.success('操作成功'); };
                const batchAction = (status) => {
                    if(selectedRows.value.length === 0) return ElMessage.warning('请选择学生');
                    selectedRows.value.forEach(row => row.enterpriseStatus = status);
                    ElMessage.success('批量操作成功');
                };
                const getStatusType = (s) => ({'Pass':'success','Fail':'danger','Pending':'warning'}[s]);
                const getStatusText = (s) => ({'Pass':'通过','Fail':'淘汰','Pending':'待筛选'}[s] || s);
                return { filterPlan, searchKeyword, tableData, handleSelectionChange, updateStatus, batchAction, getStatusType, getStatusText };
            }
        };

        const ListConfirmation = {
            template: '#tmpl-list-confirmation',
            setup() {
                const tableData = ref([
                    { id: 1, name: '张伟', school: '北京科技大学', contact: '13812345678', camp: 'Java后端-一期(北大)', enterpriseStatus: 'Pass', confirmStatus: 'Pending' },
                    { id: 2, name: '李娜', school: '上海大学', contact: '13987654321', camp: '营销管培-一期(复旦)', enterpriseStatus: 'Pass', confirmStatus: 'Confirmed' },
                    { id: 3, name: '王强', school: '深圳大学', contact: '13700001111', camp: 'Java后端-一期(北大)', enterpriseStatus: 'Pass', confirmStatus: 'Pending' }
                ]);
                const camps = ref(['Java后端-一期(北大)', '营销管培-一期(复旦)', '营销管培-二期(交大)']);
                const filterCamp = ref('');
                const selectedRows = ref([]);
                const handleSelectionChange = (val) => selectedRows.value = val;
                const updateStatus = (row, status) => { row.confirmStatus = status; ElMessage.success('操作成功'); };
                const batchAction = (status) => {
                    if(selectedRows.value.length === 0) return ElMessage.warning('请选择学生');
                    selectedRows.value.forEach(row => row.confirmStatus = status);
                    ElMessage.success('批量操作成功');
                    if (status === 'Confirmed' && filterCamp.value) {
                        if (!confirmationStore.confirmedCamps.includes(filterCamp.value)) {
                            confirmationStore.confirmedCamps.push(filterCamp.value);
                            ElMessage.success(`培训营「${filterCamp.value}」名单已标记为企业确认`);
                        }
                    }
                };
                const filteredTableData = computed(() => {
                    if (!filterCamp.value) return tableData.value;
                    return tableData.value.filter(item => item.camp === filterCamp.value);
                });
                const handleQuery = () => { ElMessage.success('查询已执行'); };
                const getConfirmStatusType = (s) => ({'Confirmed':'success','Abandoned':'info','Pending':'warning'}[s]);
                const getConfirmStatusText = (s) => ({'Confirmed':'已确认','Abandoned':'已放弃','Pending':'待确认'}[s] || s);
                return { tableData, camps, filterCamp, filteredTableData, handleSelectionChange, updateStatus, batchAction, getConfirmStatusType, getConfirmStatusText, handleQuery };
            }
        };

        const TrainingMonitoring = {
            template: '#tmpl-training-monitoring',
            setup() {
                const camps = ref([
                    { id: 3, campName: 'Java后端-一期(北大)', planName: 'Java 高级后端开发特训营', school: '北京大学', startDate: '2024-07-01', endDate: '2024-09-30' },
                    { id: 1, campName: '营销管培-一期(复旦)', planName: '数字化营销管培生计划', school: '复旦大学', startDate: '2024-08-01', endDate: '2024-08-31' },
                    { id: 2, campName: '营销管培-二期(交大)', planName: '数字化营销管培生计划', school: '上海交通大学', startDate: '2024-08-01', endDate: '2024-08-31' }
                ]);
                const selectedCampName = ref('');
                const nowStr = new Date().toISOString().split('T')[0];
                const parseDate = (s) => new Date(s + 'T00:00:00');
                const pickLatestStartedCamp = () => {
                    const started = camps.value.filter(c => c.startDate <= nowStr).sort((a, b) => b.startDate.localeCompare(a.startDate));
                    if (started.length > 0) return started[0].campName;
                    const upcoming = camps.value.slice().sort((a, b) => a.startDate.localeCompare(b.startDate));
                    return upcoming.length ? upcoming[0].campName : '';
                };
                selectedCampName.value = pickLatestStartedCamp();
                const campDetail = Vue.computed(() => {
                    return camps.value.find(c => c.campName === selectedCampName.value) || camps.value[0] || { campName: '', school: '', startDate: '', endDate: '' };
                });
                const diffDays = (a, b) => Math.max(0, Math.floor((parseDate(b) - parseDate(a)) / (1000 * 60 * 60 * 24)));
                const progressDays = Vue.computed(() => {
                    if (!campDetail.value.startDate || !campDetail.value.endDate) return 0;
                    if (nowStr < campDetail.value.startDate) return 0;
                    if (nowStr >= campDetail.value.endDate) return diffDays(campDetail.value.startDate, campDetail.value.endDate);
                    return diffDays(campDetail.value.startDate, nowStr);
                });
                const totalDays = Vue.computed(() => {
                    if (!campDetail.value.startDate || !campDetail.value.endDate) return 0;
                    return diffDays(campDetail.value.startDate, campDetail.value.endDate);
                });
                const overallRate = Vue.computed(() => '98%');
                const handleQuery = () => { ElMessage.success('查询已执行'); };

                const coursesByCamp = reactive({
                    'Java后端-一期(北大)': [
                        { id: 201, name: 'Java 并发编程', time: '2024-07-05 14:00' },
                        { id: 202, name: 'Spring Boot 实战', time: '2024-07-06 09:00' }
                    ],
                    '营销管培-一期(复旦)': [
                        { id: 301, name: '营销入门与渠道', time: '2024-08-02 09:00' }
                    ],
                    '营销管培-二期(交大)': [
                        { id: 401, name: '渠道策略实战', time: '2024-08-03 14:00' }
                    ]
                });

                const attendanceByCourse = reactive({
                    201: [
                        { name: '张伟', school: '北京科技大学', status: 'Present' },
                        { name: '李娜', school: '上海大学', status: 'Present' }
                    ],
                    202: [
                        { name: '张伟', school: '北京科技大学', status: 'Absent' },
                        { name: '王强', school: '深圳大学', status: 'Present' }
                    ],
                    301: [
                        { name: '赵敏', school: '复旦大学', status: 'Present' }
                    ],
                    401: [
                        { name: '钱坤', school: '上海交通大学', status: 'Present' }
                    ]
                });

                const studentsByCamp = {
                    'Java后端-一期(北大)': [
                        { name: '张伟', school: '北京科技大学', overallRate: 50 },
                        { name: '李娜', school: '上海大学', overallRate: 100 },
                        { name: '王强', school: '深圳大学', overallRate: 100 }
                    ],
                    '营销管培-一期(复旦)': [
                        { name: '赵敏', school: '复旦大学', overallRate: 100 }
                    ],
                    '营销管培-二期(交大)': [
                        { name: '钱坤', school: '上海交通大学', overallRate: 100 }
                    ]
                };

                const tableData = Vue.computed(() => {
                    return studentsByCamp[selectedCampName.value] || [];
                });

                const detailDialogVisible = ref(false);
                const currentStudent = ref(null);
                const currentStudentCourseRecords = ref([]);

                const handleDetail = (row) => {
                    currentStudent.value = row;
                    const campCourses = coursesByCamp[selectedCampName.value] || [];
                    const records = campCourses.map(course => {
                        const attendanceList = attendanceByCourse[course.id] || [];
                        const studentRecord = attendanceList.find(s => s.name === row.name);
                        return {
                            courseName: course.name,
                            courseTime: course.time,
                            status: studentRecord ? studentRecord.status : 'Pending'
                        };
                    });
                    currentStudentCourseRecords.value = records;
                    detailDialogVisible.value = true;
                };

                const statusDialogVisible = ref(false);
                const newStatus = ref('');
                const currentCourseRecord = ref(null);

                const handleChangeStatus = (row) => {
                    currentCourseRecord.value = row;
                    newStatus.value = row.status;
                    statusDialogVisible.value = true;
                };

                const confirmStatusChange = () => {
                    if (currentCourseRecord.value && currentStudent.value) {
                        // Update the local display record
                        currentCourseRecord.value.status = newStatus.value;
                        
                        // Update the underlying data source
                        const campCourses = coursesByCamp[selectedCampName.value] || [];
                        const course = campCourses.find(c => c.name === currentCourseRecord.value.courseName);
                        if (course) {
                            const attendanceList = attendanceByCourse[course.id] || [];
                            const studentRecord = attendanceList.find(s => s.name === currentStudent.value.name);
                            if (studentRecord) {
                                studentRecord.status = newStatus.value;
                            } else {
                                // If no record exists yet, create one
                                attendanceList.push({
                                    name: currentStudent.value.name,
                                    school: currentStudent.value.school,
                                    status: newStatus.value
                                });
                            }
                        }
                        
                        ElMessage.success('状态更新成功');
                    }
                    statusDialogVisible.value = false;
                };

                return { camps, selectedCampName, campDetail, progressDays, totalDays, overallRate, handleQuery,
                         tableData,
                         handleDetail, detailDialogVisible, currentStudent, currentStudentCourseRecords,
                         statusDialogVisible, handleChangeStatus, confirmStatusChange, newStatus, currentCourseRecord };
            }
        };

        const AssessmentResults = {
            template: '#tmpl-assessment-results',
            setup() {
                const camps = ref([
                    { id: 3, campName: 'Java后端-一期(北大)', school: '北京大学', startDate: '2024-07-01', endDate: '2024-09-30' },
                    { id: 1, campName: '营销管培-一期(复旦)', school: '复旦大学', startDate: '2024-08-01', endDate: '2024-08-31' },
                    { id: 2, campName: '营销管培-二期(交大)', school: '上海交通大学', startDate: '2024-08-01', endDate: '2024-08-31' }
                ]);
                const selectedCampName = ref('');
                const nowStr = new Date().toISOString().split('T')[0];
                const pickLatestStartedCamp = () => {
                    const started = camps.value.filter(c => c.startDate <= nowStr).sort((a, b) => b.startDate.localeCompare(a.startDate));
                    if (started.length > 0) return started[0].campName;
                    const upcoming = camps.value.slice().sort((a, b) => a.startDate.localeCompare(b.startDate));
                    return upcoming.length ? upcoming[0].campName : '';
                };
                selectedCampName.value = pickLatestStartedCamp();
                const chartDom = ref(null);
                const distMap = {
                    'Java后端-一期(北大)': [2, 5, 10, 15, 8],
                    '营销管培-一期(复旦)': [1, 4, 12, 18, 10],
                    '营销管培-二期(交大)': [0, 6, 11, 16, 12]
                };
                const tableMap = {
                    'Java后端-一期(北大)': [
                        { name: '张伟', school: '北京科技大学', major: '计算机科学与技术', score: 92, isQualified: true },
                        { name: '李娜', school: '上海大学', major: '软件工程', score: 88, isQualified: true },
                        { name: '王强', school: '深圳大学', major: '电子信息', score: 58, isQualified: false }
                    ],
                    '营销管培-一期(复旦)': [
                        { name: '赵敏', school: '复旦大学', major: '市场营销', score: 85, isQualified: true },
                        { name: '钱坤', school: '复旦大学', major: '广告学', score: 73, isQualified: true },
                        { name: '孙杰', school: '复旦大学', major: '统计学', score: 59, isQualified: false }
                    ],
                    '营销管培-二期(交大)': [
                        { name: '李四', school: '上海交通大学', major: '市场营销', score: 91, isQualified: true },
                        { name: '王五', school: '上海交通大学', major: '经济学', score: 77, isQualified: true },
                        { name: '郑十', school: '上海交通大学', major: '数据科学', score: 66, isQualified: true }
                    ]
                };
                const currentTableData = Vue.computed(() => {
                    return tableMap[selectedCampName.value] || [];
                });
                const statTotal = Vue.computed(() => currentTableData.value.length);
                const statQualified = Vue.computed(() => currentTableData.value.filter(i => i.isQualified).length);
                const statRate = Vue.computed(() => {
                    const t = statTotal.value || 1;
                    const q = statQualified.value;
                    return Math.round((q * 100) / t) + '%';
                });
                const statAvgScore = Vue.computed(() => {
                    if (currentTableData.value.length === 0) return 0;
                    const sum = currentTableData.value.reduce((s, i) => s + (i.score || 0), 0);
                    return (sum / currentTableData.value.length).toFixed(1);
                });
                const handleQuery = () => { ElMessage.success('查询已执行'); };
                let myChart;
                onMounted(() => {
                    myChart = echarts.init(chartDom.value);
                    const dist = distMap[selectedCampName.value] || [0, 0, 0, 0, 0];
                    myChart.setOption({
                        title: { text: selectedCampName.value + ' 成绩分布', left: 'center' },
                        tooltip: {},
                        xAxis: { data: ['<60', '60-70', '70-80', '80-90', '90-100'] },
                        yAxis: {},
                        series: [{ type: 'bar', data: dist, itemStyle: { color: '#409EFF' } }]
                    });
                    window.addEventListener('resize', () => myChart.resize());
                });
                Vue.watch(selectedCampName, (val) => {
                    if (!myChart) return;
                    const dist = distMap[val] || [0, 0, 0, 0, 0];
                    myChart.setOption({
                        title: { text: val + ' 成绩分布', left: 'center' },
                        series: [{ type: 'bar', data: dist, itemStyle: { color: '#409EFF' } }]
                    });
                });
                return { camps, selectedCampName, chartDom, tableData: currentTableData, statTotal, statQualified, statRate, statAvgScore, handleQuery };
            }
        };

        const TalentPool = {
            template: '#tmpl-talent-pool',
            setup() {
                const tableData = ref([
                    { name: '张伟', school: '北京科技大学', major: '计算机科学与技术', education: '本科', planName: 'Java 高级后端开发特训营', score: 92, entryDate: '2024-10-05' },
                    { name: '李娜', school: '上海大学', major: '软件工程', education: '硕士', planName: 'Java 高级后端开发特训营', score: 88, entryDate: '2024-10-05' }
                ]);
                return { tableData };
            }
        };

        const EnterpriseSettlement = {
            template: '#tmpl-enterprise-settlement',
            setup() {
                const tableData = ref([
                    { orderNo: 'SET-2024001', planName: 'Java 高级后端开发特训营', campName: 'Java后端-一期', headcount: 45, amount: '¥250,000', status: 'Pending' },
                    { orderNo: 'SET-2023099', planName: '数字化营销管培生计划', campName: '营销管培-三期', headcount: 30, amount: '¥120,000', status: 'Paid' }
                ]);
                const handlePay = (row) => {
                    ElMessageBox.confirm(`确认支付结算单 ${row.orderNo} ?`, '支付确认').then(() => {
                        row.status = 'Paid';
                        ElMessage.success('支付成功');
                    });
                };
                return { tableData, handlePay };
            }
        };

        const EnterpriseLayout = {
            template: '#tmpl-enterprise-layout',
            components: { PlanManagement, StudentScreening, ListConfirmation, TrainingMonitoring, AssessmentResults, TalentPool, EnterpriseSettlement },
            setup() {
                const route = useRoute();
                const activeTab = computed(() => route.query.tab || 'plan');
                return { activeTab };
            }
        };

        const confirmationStore = reactive({ confirmedCamps: [] });

        // --- 2. Operation Logic ---
        const opStore = reactive({ activeTab: 'audit', filterCamp: '' });

        const courseStore = reactive({
            allCourses: [
                { id: 1, name: '营销入门与渠道', content: '营销基础知识与渠道策略概览', teacher: '王老师' },
                { id: 2, name: 'Java 并发编程', content: '线程、锁与并发工具类实战', teacher: '李老师' },
                { id: 3, name: 'Spring Boot 实战', content: '基于Spring Boot构建企业级应用', teacher: '张老师' }
            ]
        });

        const PlanAudit = {
            template: '#tmpl-plan-audit',
            setup() {
                const loading = ref(false);
                const searchQuery = ref('');
                const filterStatus = ref('');
                const auditVisible = ref(false);
                const isViewMode = ref(false);
                const currentPlan = ref({});
                const auditResult = ref('Approved');
                const rejectReason = ref('');
                
                const tableData = ref([
                    { id: 1, planName: 'Java 高级后端开发特训营', enterprise: '某知名互联网公司', positionType: '技术类', headcount: 50, submitTime: '2024-05-15', period: '2024-07-01~2024-09-30', location: '北京', budget: '¥250,000', education: '本科, 硕士', major: '计算机, 软件工程', skills: 'Java, Spring Boot, MySQL, Redis', remark: '重点培养分布式系统架构设计能力，对标阿里P6级别。', status: 'Pending' },
                    { id: 2, planName: '数字化营销管培生计划', enterprise: '某大型快消集团', positionType: '营销类', headcount: 30, submitTime: '2024-05-18', period: '2024-08-01~2024-08-31', location: '上海', budget: '¥120,000', education: '本科', major: '市场营销, 广告学', skills: '数据分析, 策划能力', remark: '面向应届毕业生，培养全渠道营销人才。', status: 'Approved' },
                    { id: 3, planName: '智能制造生产管理', enterprise: '高端制造产业园', positionType: '生产类', headcount: 100, submitTime: '2024-06-01', period: '2024-09-01~2024-11-30', location: '深圳', budget: '¥300,000', education: '大专, 本科', major: '机械工程, 自动化', skills: 'PLC编程, 生产管理', remark: '', status: 'Rejected', auditComment: '预算超标，建议调整至25万以内。' }
                ]);
                
                const getStatusLabel = (status) => {
                    const map = { 'Pending': '待审核', 'Approved': '已通过', 'Rejected': '已驳回' };
                    return map[status] || status;
                };
                const getStatusType = (status) => {
                    const map = { 'Pending': 'warning', 'Approved': 'success', 'Rejected': 'danger' };
                    return map[status] || '';
                };

                const handleAudit = (row) => { 
                    currentPlan.value = { ...row }; 
                    auditVisible.value = true; 
                    isViewMode.value = false;
                    auditResult.value = 'Approved';
                    rejectReason.value = ''; 
                };

                const handleView = (row) => {
                    currentPlan.value = { ...row };
                    auditVisible.value = true;
                    isViewMode.value = true;
                };

                const submitAudit = () => {
                    if (auditResult.value === 'Rejected' && !rejectReason.value.trim()) {
                        return ElMessage.error('请填写驳回原因');
                    }
                    
                    const idx = tableData.value.findIndex(item => item.id === currentPlan.value.id);
                    if (idx !== -1) {
                        tableData.value[idx].status = auditResult.value;
                        if (auditResult.value === 'Rejected') {
                            tableData.value[idx].auditComment = rejectReason.value;
                        }
                    }
                    
                    ElMessage.success(auditResult.value === 'Approved' ? '审核通过' : '已驳回');
                    auditVisible.value = false;
                };
                return { loading, searchQuery, filterStatus, tableData, auditVisible, isViewMode, currentPlan, auditResult, rejectReason, 
                         getStatusLabel, getStatusType, handleAudit, handleView, submitAudit };
            }
        };

        const TrainingConfig = {
            template: '#tmpl-training-config',
            setup() {
                const router = useRouter();
                const dialogVisible = ref(false);
                const dialogTitle = ref('新建培训营');
                const qrVisible = ref(false);
                const isViewMode = ref(false);
                const currentCamp = ref({});
                const currentPlanInfo = ref({});
                const formRef = ref(null);

                const searchKeyword = ref('');
                const filterDateRange = ref(null);
                
                const approvedPlans = [
                    { id: 101, planName: '数字化营销管培生计划', enterprise: '某大型快消集团', startDate: '2024-08-01', endDate: '2024-08-31', remainingHeadcount: 30, headcount: 30, positionType: '营销类', location: '上海', budget: '¥120,000', education: '本科', major: '市场营销, 广告学', skills: '数据分析, 策划能力', remark: '面向应届毕业生，培养全渠道营销人才。' },
                    { id: 102, planName: 'Java 高级后端开发特训营', enterprise: '某知名互联网公司', startDate: '2024-07-01', endDate: '2024-09-30', remainingHeadcount: 20, headcount: 50, positionType: '技术类', location: '北京', budget: '¥250,000', education: '本科, 硕士', major: '计算机, 软件工程', skills: 'Java, Spring Boot, MySQL, Redis', remark: '重点培养分布式系统架构设计能力，对标阿里P6级别。' },
                    { id: 103, planName: '大数据分析师培养计划', enterprise: '某数据科技公司', startDate: '2023-09-01', endDate: '2023-12-01', remainingHeadcount: 0, headcount: 20, positionType: '技术类', location: '深圳', budget: '¥180,000', education: '本科', major: '统计学, 数学', skills: 'Python, SQL, Hadoop', remark: '历史计划' }
                ];
                
                const schools = ['北京大学', '清华大学', '复旦大学', '上海交通大学', '浙江大学', '武汉大学', '哈尔滨工业大学'];
                
                const tableData = ref([
                    { id: 1, campName: '营销管培-一期(复旦)', planName: '数字化营销管培生计划', enterprise: '某大型快消集团', school: '复旦大学', startDate: '2024-08-01', endDate: '2024-08-31', enrolled: 15, headcount: 15, status: 'Pending', courses: [] },
                    { id: 2, campName: '营销管培-二期(交大)', planName: '数字化营销管培生计划', enterprise: '某大型快消集团', school: '上海交通大学', startDate: '2024-08-01', endDate: '2024-08-31', enrolled: 12, headcount: 15, status: 'Pending', courses: [] },
                    { id: 3, campName: 'Java后端-一期(北大)', planName: 'Java 高级后端开发特训营', enterprise: '某知名互联网公司', school: '北京大学', startDate: '2024-07-01', endDate: '2024-09-30', enrolled: 30, headcount: 30, status: 'Ongoing', courses: [] },
                    { id: 4, campName: '大数据分析-一期(清华)', planName: '大数据分析师培养计划', enterprise: '某数据科技公司', school: '清华大学', startDate: '2023-09-01', endDate: '2023-12-01', enrolled: 20, headcount: 20, status: 'Finished', courses: [] }
                ]);

                const form = reactive({
                    id: null, planIds: [], campName: '', school: '', dateRange: [], headcount: 0,
                    passScoreThreshold: 60, targetPassRate: 80, requiredLessons: 20, attendanceWeight: 50, reviewWeight: 50,
                    badges: []
                });

                const rules = {
                    planIds: [{ required: true, message: '必选', trigger: 'change', type: 'array' }],
                    school: [{ required: true, message: '必选', trigger: 'change' }],
                    campName: [{ required: true, message: '必填', trigger: 'blur' }],
                    dateRange: [{ required: true, message: '必填', trigger: 'change' }],
                    headcount: [{ required: true, message: '必填', trigger: 'blur' }],
                    passScoreThreshold: [{ required: true, message: '必填', trigger: 'blur', type: 'number', min: 0, max: 100 }],
                    targetPassRate: [{ required: true, message: '必填', trigger: 'blur', type: 'number', min: 0, max: 100 }],
                    requiredLessons: [{ required: true, message: '必填', trigger: 'blur', type: 'number', min: 0 }],
                    attendanceWeight: [{ required: true, message: '必填', trigger: 'blur', type: 'number', min: 0, max: 100 }],
                    reviewWeight: [{ required: true, message: '必填', trigger: 'blur', type: 'number', min: 0, max: 100 }]
                };

                const getStatusLabel = (status) => {
                    const map = { 'Pending': '未开始', 'Ongoing': '进行中', 'Finished': '已结束' };
                    return map[status] || status;
                };
                const getStatusType = (status) => {
                    const map = { 'Pending': 'info', 'Ongoing': 'primary', 'Finished': 'danger' };
                    return map[status] || '';
                };
                
                const determineStatus = (startDate, endDate) => {
                    const now = new Date().toISOString().split('T')[0];
                    if (endDate && now > endDate) return 'Finished';
                    if (startDate && endDate && now >= startDate && now <= endDate) return 'Ongoing';
                    return 'Pending';
                };

                const addBadge = () => {
                    const id = Date.now() + Math.random();
                    if (!form.badges) {
                        form.badges = [];
                    }
                    form.badges.push({
                        id,
                        name: '',
                        iconUrl: ''
                    });
                };

                const removeBadge = (index) => {
                    if (!form.badges || index < 0 || index >= form.badges.length) return;
                    form.badges.splice(index, 1);
                };

                const handleBadgeIconBeforeUpload = (file, index) => {
                    if (!file || !form.badges || !form.badges[index]) return false;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const result = e.target && e.target.result;
                        if (typeof result === 'string' && form.badges[index]) {
                            form.badges[index].iconUrl = result;
                        }
                    };
                    reader.readAsDataURL(file);
                    return false;
                };

                const handleToStudent = (row) => {
                    opStore.filterCamp = row.campName;
                    opStore.activeTab = 'student';
                };
                const courseConfigVisible = ref(false);
                const courseConfigCamp = ref(null);
                const courseConfigList = ref([]);
                const courseFilterKeyword = ref('');
                const selectedCourseConfigList = computed(() => {
                    return courseConfigList.value.filter(item => item.selected);
                });
                const filteredCoursePoolList = computed(() => {
                    return courseConfigList.value.filter(item => {
                        if (!courseFilterKeyword.value) return true;
                        const kw = courseFilterKeyword.value.toLowerCase();
                        return item.name && item.name.toLowerCase().includes(kw);
                    });
                });

                const currentCampCourses = ref([]);

                const handleConfigCourses = (row) => {
                    courseConfigCamp.value = row;
                    currentCampCourses.value = (row.courses || []).slice().sort((a, b) => {
                        if (!a.schedule || !b.schedule) return 0;
                        return a.schedule.localeCompare(b.schedule);
                    });
                    courseConfigList.value = courseStore.allCourses.map(course => {
                        const existing = (row.courses || []).find(c => c.courseId === course.id);
                        return {
                            courseId: course.id,
                            name: course.name,
                            content: course.content,
                            teacher: course.teacher,
                            schedule: existing ? existing.schedule : '',
                            location: existing ? existing.location : '',
                            selected: !!existing
                        };
                    });
                    courseFilterKeyword.value = '';
                    courseConfigVisible.value = true;
                };

                const saveCourseConfig = () => {
                    if (!courseConfigCamp.value) return;
                    const selected = courseConfigList.value.filter(item => item.selected && item.schedule && item.location);
                    const newCourses = selected.map(item => ({
                        courseId: item.courseId,
                        name: item.name,
                        content: item.content,
                        teacher: item.teacher,
                        schedule: item.schedule,
                        location: item.location
                    }));
                    courseConfigCamp.value.courses = newCourses;
                    currentCampCourses.value = newCourses.slice().sort((a, b) => {
                        if (!a.schedule || !b.schedule) return 0;
                        return a.schedule.localeCompare(b.schedule);
                    });
                    ElMessage.success('课程配置已保存');
                    courseConfigVisible.value = false;
                };

                const handleStart = (row) => {
                    if (!confirmationStore.confirmedCamps.includes(row.campName)) {
                        ElMessage.warning('企业未确认名单，暂不可启动');
                        return;
                    }
                    row.status = 'Ongoing';
                    ElMessage.success(`培训营「${row.campName}」已启动`);
                };

                const onPlanChange = (planIds) => {
                    if (planIds && planIds.length > 0) {
                        // Use the first selected plan to pre-fill some info, or aggregate
                        const lastId = planIds[planIds.length - 1];
                        const plan = approvedPlans.find(p => p.id === lastId);
                        if (plan) {
                             if (!form.campName) form.campName = plan.planName + '等-联合培训';
                             if (!form.dateRange || form.dateRange.length === 0) form.dateRange = [plan.startDate, plan.endDate];
                             
                             // Sum up remaining headcount
                             const totalRemaining = planIds.reduce((sum, pid) => {
                                 const p = approvedPlans.find(ap => ap.id === pid);
                                 return sum + (p ? (p.remainingHeadcount || 0) : 0);
                             }, 0);
                             form.headcount = totalRemaining;
                        }
                    } else {
                        form.headcount = 0;
                    }
                };

                const filteredTableData = computed(() => {
                    return tableData.value.filter(item => {
                        const matchKeyword = !searchKeyword.value || 
                            item.campName.toLowerCase().includes(searchKeyword.value.toLowerCase()) ||
                            item.planName.toLowerCase().includes(searchKeyword.value.toLowerCase());
                        
                        const matchDate = !filterDateRange.value || 
                            (item.startDate >= filterDateRange.value[0] && item.endDate <= filterDateRange.value[1]);
                        
                        return matchKeyword && matchDate;
                    });
                });

                const handleSearch = () => {
                    // Filter logic is handled by computed property
                    ElMessage.success('查询已执行');
                };

                const handleDelete = (row) => {
                    ElMessageBox.confirm('确定删除该培训营吗?', '提示', { type: 'warning' }).then(() => {
                        tableData.value = tableData.value.filter(item => item.id !== row.id);
                        ElMessage.success('已删除');
                    });
                };

                const handleCreate = () => {
                    dialogTitle.value = '新建培训营';
                    isViewMode.value = false;
                    Object.assign(form, { id: null, planIds: [], campName: '', school: '', dateRange: [], headcount: 0,
                        passScoreThreshold: 60, targetPassRate: 80, requiredLessons: 20, attendanceWeight: 50, reviewWeight: 50,
                        badges: []
                    });
                    dialogVisible.value = true;
                };

                const handleEdit = (row) => {
                    dialogTitle.value = '修改配置';
                    isViewMode.value = false;
                    // Find original plan id (mock) - assume single for edit mock or split logic
                    const plan = approvedPlans.find(p => p.planName === row.planName);
                    Object.assign(form, {
                        id: row.id,
                        planIds: plan ? [plan.id] : [],
                        campName: row.campName,
                        school: row.school,
                        dateRange: [row.startDate, row.endDate],
                        headcount: row.headcount,
                        passScoreThreshold: row.passScoreThreshold ?? 60,
                        targetPassRate: row.targetPassRate ?? 80,
                        requiredLessons: row.requiredLessons ?? 20,
                        attendanceWeight: row.attendanceWeight ?? 50,
                        reviewWeight: row.reviewWeight ?? 50,
                        badges: (row.badges || []).map((b, idx) => ({
                            id: b.id || `${row.id || 'camp'}_${idx}`,
                            name: b.name || '',
                            iconUrl: b.iconUrl || ''
                        }))
                    });
                    dialogVisible.value = true;
                };

                const handleDetail = (row) => {
                    dialogTitle.value = '培训营详情';
                    isViewMode.value = true;
                    
                    const plan = approvedPlans.find(p => p.planName === row.planName);
                    if(plan) {
                        currentPlanInfo.value = { ...plan };
                    } else {
                        currentPlanInfo.value = { planName: row.planName, enterprise: row.enterprise, startDate: row.startDate, endDate: row.endDate, headcount: '未知' };
                    }

                    Object.assign(form, {
                        id: row.id,
                        planIds: plan ? [plan.id] : [],
                        campName: row.campName,
                        school: row.school,
                        dateRange: [row.startDate, row.endDate],
                        headcount: row.headcount,
                        passScoreThreshold: row.passScoreThreshold ?? 60,
                        targetPassRate: row.targetPassRate ?? 80,
                        requiredLessons: row.requiredLessons ?? 20,
                        attendanceWeight: row.attendanceWeight ?? 50,
                        reviewWeight: row.reviewWeight ?? 50,
                        badges: (row.badges || []).map((b, idx) => ({
                            id: b.id || `${row.id || 'camp'}_${idx}`,
                            name: b.name || '',
                            iconUrl: b.iconUrl || ''
                        }))
                    });
                    currentCampCourses.value = (row.courses || []).slice().sort((a, b) => {
                        if (!a.schedule || !b.schedule) return 0;
                        return a.schedule.localeCompare(b.schedule);
                    });
                    dialogVisible.value = true;
                };

                const handleConfirm = (row) => {
                    ElMessageBox.confirm('确认发送最终名单给企业吗?', '提示', { type: 'success' }).then(() => {
                        ElMessage.success('名单已发送');
                    });
                };

                const showQRCode = (row) => {
                    currentCamp.value = row;
                    qrVisible.value = true;
                };

                const submitForm = async () => {
                    if (!formRef.value) return;
                    await formRef.value.validate((valid) => {
                        if (valid) {
                            // Find all selected plans
                            const selectedPlans = approvedPlans.filter(p => form.planIds.includes(p.id));
                            const planNames = selectedPlans.map(p => p.planName).join(', ');
                            const enterprises = [...new Set(selectedPlans.map(p => p.enterprise))].join(', ');

                            const newId = form.id || Date.now();
                            const newItem = {
                                id: newId,
                                campName: form.campName,
                                planName: planNames,
                                enterprise: enterprises,
                                school: form.school,
                                startDate: form.dateRange[0],
                                endDate: form.dateRange[1],
                                headcount: form.headcount,
                                status: determineStatus(form.dateRange[0], form.dateRange[1]),
                                passScoreThreshold: form.passScoreThreshold,
                                targetPassRate: form.targetPassRate,
                                requiredLessons: form.requiredLessons,
                                attendanceWeight: form.attendanceWeight,
                                reviewWeight: form.reviewWeight,
                                badges: (form.badges || []).map((b, idx) => ({
                                    id: b.id || `${newId || 'camp'}_${idx}`,
                                    name: b.name || '',
                                    iconUrl: b.iconUrl || ''
                                }))
                            };

                            if (form.id) {
                                const idx = tableData.value.findIndex(item => item.id === form.id);
                                if (idx !== -1) tableData.value[idx] = { ...tableData.value[idx], ...newItem };
                            } else {
                                tableData.value.push(newItem);
                            }
                            dialogVisible.value = false;
                            ElMessage.success('配置保存成功');
                        }
                    });
                };

                return { tableData, filteredTableData, searchKeyword, filterDateRange, dialogVisible, dialogTitle, qrVisible, currentCamp, form, rules, formRef, 
                         approvedPlans, schools, getStatusLabel, getStatusType, isViewMode, currentPlanInfo, currentCampCourses,
                         handleCreate, handleEdit, showQRCode, onPlanChange, submitForm, handleToStudent, handleStart, handleSearch, handleDelete, handleDetail, handleConfirm,
                         courseConfigVisible, courseConfigCamp, courseConfigList, handleConfigCourses, saveCourseConfig,
                         courseFilterKeyword, selectedCourseConfigList, filteredCoursePoolList,
                         addBadge, removeBadge, handleBadgeIconBeforeUpload };
            }
        };

        const StudentManagementOp = {
            template: '#tmpl-student-management-op',
            components: { TrainingMonitoring },
            setup() {
                const activeSubTab = ref('screening');
                const selectedRows = ref([]);
                const filterCamp = ref('');
                
                const screeningList = ref([
                    { name: '赵六', school: '浙江大学', major: '软件工程', camp: 'Java后端-一期(北大)', match: '90%', status: 'Pending' },
                    { name: '钱七', school: '复旦大学', major: '市场营销', camp: '营销管培-一期(复旦)', match: '85%', status: 'Passed' },
                    { name: '孙八', school: '武汉大学', major: '通信工程', camp: 'Java后端-一期(北大)', match: '60%', status: 'Rejected' },
                    { name: '李九', school: '上海交通大学', major: '软件工程', camp: '营销管培-二期(交大)', match: '92%', status: 'Pending' }
                ]);
                
                // Watch for shared state changes
                Vue.watch(() => opStore.filterCamp, (newVal) => {
                    if (newVal) {
                        activeSubTab.value = 'screening';
                        filterCamp.value = newVal;
                        opStore.filterCamp = ''; // reset
                    }
                });

                const filteredScreeningList = computed(() => {
                    if (!filterCamp.value) return screeningList.value;
                    return screeningList.value.filter(item => item.camp === filterCamp.value);
                });
                
                const finalList = ref([
                    { name: '张伟', camp: 'Java后端-一期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Pending' },
                    { name: '李娜', camp: '营销管培-三期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Confirmed' },
                    { name: '王强', camp: 'Java后端-一期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Pending' },
                    { name: '刘洋', camp: '营销管培-三期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Confirmed' },
                    { name: '陈静', camp: 'Java后端-一期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Pending' },
                    { name: '杨明', camp: '营销管培-三期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Confirmed' },
                    { name: '赵云', camp: 'Java后端-一期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Pending' },
                    { name: '孙悟空', camp: '营销管培-三期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Confirmed' },
                    { name: '猪八戒', camp: 'Java后端-一期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Pending' },
                    { name: '沙僧', camp: '营销管培-三期', enterpriseStatus: 'Passed', studentConfirm: 'Confirmed', opStatus: 'Confirmed' }
                ]);
                
                const getScreenStatusLabel = (status) => ({ 'Pending': '待筛选', 'Passed': '已通过', 'Rejected': '已淘汰' }[status] || status);
                const getScreenStatusType = (status) => ({ 'Pending': 'warning', 'Passed': 'success', 'Rejected': 'danger' }[status] || '');
                const getOpConfirmStatusText = (status) => ({ 'Confirmed': '已确认', 'Pending': '待确认' }[status] || status);

                const handleSelectionChange = (val) => selectedRows.value = val;
                
                const updateScreenStatus = (row, status) => {
                    row.status = status;
                    ElMessage.success('操作成功');
                };
                
                const batchScreen = (status) => {
                    if (selectedRows.value.length === 0) return ElMessage.warning('请先选择学生');
                    selectedRows.value.forEach(row => row.status = status);
                    ElMessage.success(`批量${status === 'Passed' ? '通过' : '淘汰'}成功`);
                };

                const confirmStudent = (row) => {
                    row.opStatus = 'Confirmed';
                    ElMessage.success('已确认名单');
                };
                
                const sendToEnterprise = () => {
                    ElMessage.success('最终名单已发送给企业');
                };

                return { activeSubTab, screeningList, filteredScreeningList, filterCamp, finalList,
                         getScreenStatusLabel, getScreenStatusType, getOpConfirmStatusText,
                         handleSelectionChange, updateScreenStatus, batchScreen, confirmStudent, sendToEnterprise };
            }
        };

        const CourseManagementOp = {
            template: '#tmpl-course-management-op',
            setup() {
                const formRef = ref(null);
                const dialogVisible = ref(false);
                const dialogTitle = ref('新建课程');
                const form = reactive({ id: null, name: '', content: '', teacher: '' });
                const rules = {
                    name: [{ required: true, message: '必填', trigger: 'blur' }],
                    content: [{ required: true, message: '必填', trigger: 'blur' }],
                    teacher: [{ required: true, message: '必填', trigger: 'blur' }]
                };
                const editingId = ref(null);
                
                const courseList = computed(() => {
                    return courseStore.allCourses;
                });
                
                const openCreate = () => {
                    dialogTitle.value = '新建课程';
                    editingId.value = null;
                    Object.assign(form, { id: null, name: '', content: '', teacher: '' });
                    dialogVisible.value = true;
                };
                const openEdit = (row) => {
                    dialogTitle.value = '编辑课程';
                    editingId.value = row.id;
                    Object.assign(form, { id: row.id, name: row.name, content: row.content, teacher: row.teacher });
                    dialogVisible.value = true;
                };
                const submitForm = async () => {
                    if (!formRef.value) return;
                    await formRef.value.validate((valid) => {
                        if (valid) {
                            if (editingId.value != null) {
                                const idx = courseStore.allCourses.findIndex(c => c.id === editingId.value);
                                if (idx !== -1) {
                                    courseStore.allCourses[idx] = { id: editingId.value, name: form.name, content: form.content, teacher: form.teacher };
                                }
                            } else {
                                const newId = Date.now();
                                courseStore.allCourses.push({ id: newId, name: form.name, content: form.content, teacher: form.teacher });
                            }
                            dialogVisible.value = false;
                            ElMessage.success('课程保存成功');
                        }
                    });
                };
                const removeCourse = (row) => {
                    ElMessageBox.confirm(
                        `确认删除课程「${row.name}」？`,
                        '删除课程',
                        { type: 'warning' }
                    ).then(() => {
                        const idx = courseStore.allCourses.findIndex(c => c.id === row.id);
                        if (idx === -1) return;
                        courseStore.allCourses.splice(idx, 1);
                        ElMessage.success('已删除课程');
                    });
                };
                
                return { courseList, dialogVisible, dialogTitle, form, formRef, rules,
                         openCreate, openEdit, submitForm, removeCourse };
            }
        };

        const SettlementManagement = {
            template: '#tmpl-settlement-management',
            setup() {
                const tableData = ref([{ id: 'SET-2024001', enterprise: '某科技公司', camp: 'Spring特训营', amount: '¥50,000', status: 'Pending' }]);
                return { tableData };
            }
        };

        const OperationLayout = {
            template: '#tmpl-operation-layout',
            components: { PlanAudit, TrainingConfig, CourseManagementOp, StudentManagementOp, SettlementManagement },
            setup() {
                const route = useRoute();
                // Sync opStore with URL
                Vue.watch(() => route.query.tab, (newTab) => {
                    if (newTab) opStore.activeTab = newTab;
                }, { immediate: true });
                
                // Sync opStore back to URL if changed internally? 
                // In this design, URL drives state.
                if (!route.query.tab) opStore.activeTab = 'audit';
                
                return { opStore };
            }
        };

        // --- 3. School Logic ---
        const SchoolTraining = {
            template: '#tmpl-school-training',
            setup() {
                const publishVisible = ref(false);
                const studentsVisible = ref(false);
                const detailVisible = ref(false);
                const currentPlan = ref({});
                const currentPlanDetail = ref({
                    planName: '', enterprise: '', period: '', headcount: '',
                    positionType: '', location: '', budget: '', education: '',
                    major: '', skills: '', remark: ''
                });
                const studentList = ref([]);
                
                const tableData = ref([
                    { id: 101, planName: 'Java 全栈开发特训营', enterprise: '某知名互联网公司', positionType: '技术类', headcount: 50, enrolled: 32, period: '2024-03-01~2024-06-30', status: 'Registering', publishType: 'Now', deadline: '2024-02-28', content: '全栈开发特训...', location: '北京', budget: '¥250,000', education: '本科, 硕士', major: '计算机, 软件工程', skills: 'Java, Spring Boot, MySQL, Redis', remark: '重点培养分布式系统架构设计能力，对标阿里P6级别。' },
                    { id: 102, planName: '产品经理精英训练营', enterprise: '某知名互联网公司', positionType: '管理类', headcount: 30, enrolled: 12, period: '2024-04-01~2024-05-01', status: 'Publishing', publishType: 'Now', deadline: '2024-03-20', content: '面向2024届毕业生...', location: '上海', budget: '¥120,000', education: '本科', major: '市场营销, 广告学', skills: '数据分析, 策划能力', remark: '面向应届毕业生，培养全渠道营销人才。' },
                    { id: 103, planName: 'AI大模型应用实战', enterprise: '未来科技', positionType: '技术类', headcount: 40, enrolled: 40, period: '2024-05-01~2024-07-30', status: 'Closed', location: '深圳', budget: '¥300,000', education: '硕士', major: '人工智能', skills: 'Python, PyTorch', remark: '报名已结束，准备开营' },
                    { id: 104, planName: '高级前端架构师', enterprise: '云端互联', positionType: '技术类', headcount: 20, enrolled: 20, period: '2024-02-01~2024-04-30', status: 'Training', location: '杭州', budget: '¥180,000', education: '本科', major: '计算机', skills: 'Vue3, React, Node.js', remark: '架构设计能力提升' },
                    { id: 105, planName: '数字化运营专家', enterprise: '电商集团', positionType: '运营类', headcount: 25, enrolled: 25, period: '2023-11-01~2024-01-31', status: 'Finished', location: '广州', budget: '¥150,000', education: '本科', major: '电子商务', skills: '数据分析, 用户增长', remark: '已结营' },
                    { id: 106, planName: '区块链技术入门', enterprise: '链上科技', positionType: '技术类', headcount: 30, enrolled: 0, period: '2024-06-01~2024-08-31', status: 'NotStarted', location: '成都', budget: '¥200,000', education: '本科', major: '计算机', skills: 'Go, Solidity', remark: '等待开营' },
                ]);
                
                const publishForm = reactive({ title: '', content: '', deadline: '', publishType: 'Now' });
                
                const getStatusLabel = (status) => {
                    const map = { 'Assigned': '待确认', 'Confirmed': '已接收', 'Publishing': '招募中', 'Registering': '招募中', 'Closed': '报名截止', 'Rejected': '已拒绝', 'NotStarted': '未开始', 'Training': '进行中', 'Finished': '已结束' };
                    return map[status] || status;
                };
                const getStatusType = (status) => {
                    const map = { 'Assigned': 'warning', 'Confirmed': 'info', 'Publishing': 'primary', 'Registering': 'primary', 'Closed': 'info', 'Rejected': 'danger', 'NotStarted': 'info', 'Training': 'success', 'Finished': 'info' };
                    return map[status] || '';
                };

                const logsVisible = ref(false);
                const publishLogs = ref([
                    { id: 1, planId: 101, action: '发布招募', operator: '管理员', time: '2024-02-20 10:00:00', content: '首次发布招募信息' },
                    { id: 2, planId: 102, action: '发布招募', operator: '管理员', time: '2024-03-10 14:30:00', content: '发布产品经理训练营招募' },
                    { id: 3, planId: 102, action: '编辑招募', operator: '管理员', time: '2024-03-12 09:15:00', content: '修改报名截止时间至2024-03-20' }
                ]);
                const currentLogs = ref([]);
                const handleViewLogs = (row) => {
                    currentLogs.value = publishLogs.value.filter(log => log.planId === row.id);
                    logsVisible.value = true;
                };

                const handleConfirm = (row) => {
                    ElMessageBox.confirm(`确认接收 ${row.planName} 计划吗?`, '确认接单').then(() => {
                        row.status = 'Confirmed';
                        ElMessage.success('已确认接收，请配置招募信息');
                    });
                };
                
                const handleReject = (row) => {
                     ElMessageBox.confirm(`确定拒绝该计划吗?`, '提示', { type: 'warning' }).then(() => {
                        row.status = 'Rejected';
                        ElMessage.info('已拒绝该计划');
                    });
                };

                const handlePublish = (row) => { 
                    currentPlan.value = row;
                    publishForm.title = row.planName + ' 招募启动'; 
                    publishForm.content = row.content || '';
                    publishForm.deadline = row.deadline || '';
                    publishForm.publishType = row.publishType || 'Now';
                    publishVisible.value = true; 
                };

                const confirmPublish = () => { 
                    const idx = tableData.value.findIndex(item => item.id === currentPlan.value.id);
                    if (idx !== -1) {
                        tableData.value[idx].status = 'Publishing';
                        tableData.value[idx].content = publishForm.content;
                        tableData.value[idx].deadline = publishForm.deadline;
                        tableData.value[idx].publishType = publishForm.publishType;
                        publishLogs.value.push({
                            id: Date.now(),
                            planId: currentPlan.value.id,
                            action: '发布招募',
                            operator: '管理员',
                            time: new Date().toISOString().replace('T',' ').slice(0,19),
                            content: `发布：${publishForm.title}`
                        });
                    }
                    publishVisible.value = false; 
                    ElMessage.success('发布成功'); 
                };

                const handleCancelPublish = (row) => {
                    ElMessageBox.confirm('确认撤销该计划的招募信息吗？', '撤销招募', { type: 'warning' }).then(() => {
                        row.status = 'Confirmed';
                        row.content = '';
                        row.deadline = '';
                        row.publishType = '';
                        publishLogs.value.push({
                            id: Date.now(),
                            planId: row.id,
                            action: '撤销招募',
                            operator: '管理员',
                            time: new Date().toISOString().replace('T',' ').slice(0,19),
                            content: '已撤销该计划的招募信息'
                        });
                        ElMessage.success('已撤销招募');
                    });
                };

                const handleViewStudents = (row) => {
                    currentPlan.value = row;
                    // Mock student data
                    studentList.value = [
                        { name: '张三', school: '北京大学', major: '计算机科学与技术', applyTime: '2024-03-15 10:00:00' },
                        { name: '李四', school: '清华大学', major: '软件工程', applyTime: '2024-03-15 14:30:00' },
                        { name: '王五', school: '北京航空航天大学', major: '人工智能', applyTime: '2024-03-16 09:15:00' },
                        { name: '赵六', school: '北京邮电大学', major: '通信工程', applyTime: '2024-03-16 11:20:00' }
                    ];
                    studentsVisible.value = true;
                };

                const handleDetail = (row) => {
                    currentPlanDetail.value = row;
                    detailVisible.value = true;
                };

                return { tableData, publishVisible, studentsVisible, detailVisible, publishForm, currentPlan, currentPlanDetail, studentList,
                         getStatusLabel, getStatusType, logsVisible, currentLogs, publishLogs,
                         handleConfirm, handleReject, handlePublish, confirmPublish, handleCancelPublish, handleViewStudents, handleDetail, handleViewLogs };
            }
        };

        const SchoolAttendance = {
            template: '#tmpl-school-attendance',
            setup() {
                const courses = ref([
                    { name: 'Java 并发编程', time: '2024-07-05 14:00', location: '301教室', signed: '45/50' },
                    { name: 'Spring Boot 实战', time: '2024-07-06 09:00', location: '301教室', signed: '48/50' }
                ]);
                
                const dialogVisible = ref(false);
                const form = reactive({
                    name: '',
                    time: '',
                    location: ''
                });

                const createCourse = () => {
                    form.name = '';
                    form.time = '';
                    form.location = '';
                    dialogVisible.value = true;
                };

                const handleSubmit = () => {
                    if (!form.name || !form.time || !form.location) {
                        ElMessage.warning('请填写完整信息');
                        return;
                    }
                    courses.value.push({
                        name: form.name,
                        time: form.time,
                        location: form.location,
                        signed: '0/50'
                    });
                    dialogVisible.value = false;
                    ElMessage.success('课程创建成功');
                };

                const detailVisible = ref(false);
                const currentCourse = ref(null);
                const attendanceList = ref([]);

                const handleDetail = (row) => {
                    currentCourse.value = row;
                    // Mock attendance list
                    attendanceList.value = [
                        { name: '张三', school: '北京大学', status: 'Present', time: '13:55' },
                        { name: '李四', school: '清华大学', status: 'Present', time: '13:58' },
                        { name: '王五', school: '北京航空航天大学', status: 'Absent', time: '-' }
                    ];
                    detailVisible.value = true;
                };

                return { courses, createCourse, dialogVisible, form, handleSubmit, detailVisible, currentCourse, attendanceList, handleDetail };
            }
        };

        const SchoolAssessment = {
            template: '#tmpl-school-assessment',
            setup() {
                const selectedCamp = ref('1');
                const chartDom = ref(null);
                const tableData = ref([
                    { name: '张伟', school: '北京科技大学', major: '计算机科学与技术', score: 92, isQualified: true },
                    { name: '李娜', school: '上海大学', major: '软件工程', score: 88, isQualified: true },
                    { name: '王强', school: '深圳大学', major: '电子信息', score: 58, isQualified: false }
                ]);

                const campGoals = reactive({ passScoreThreshold: 60, targetPassRate: 80 });
                const stats = computed(() => {
                    const total = tableData.value.length;
                    const qualified = tableData.value.filter(item => item.isQualified).length;
                    const avgScore = total > 0 ? (tableData.value.reduce((acc, curr) => acc + (curr.score || 0), 0) / total).toFixed(1) : 0;
                    return {
                        total,
                        qualified,
                        rate: total > 0 ? ((qualified / total) * 100).toFixed(1) : 0,
                        avgScore
                    };
                });

                const initChart = () => {
                    if (!chartDom.value) return;
                    const myChart = echarts.init(chartDom.value);
                    const scores = tableData.value.map(item => item.score);
                    const ranges = ['<阈值', '60-70', '70-80', '80-90', '90-100'];
                    const data = [0, 0, 0, 0, 0];
                    scores.forEach(s => {
                        if (s < campGoals.passScoreThreshold) data[0]++;
                        else if (s < 70) data[1]++;
                        else if (s < 80) data[2]++;
                        else if (s < 90) data[3]++;
                        else data[4]++;
                    });

                    myChart.setOption({
                        title: { text: '成绩分布', left: 'center' },
                        tooltip: {},
                        xAxis: { data: ranges },
                        yAxis: {},
                        series: [{ type: 'bar', data: data, itemStyle: { color: '#409EFF' } }]
                    });
                    window.addEventListener('resize', () => myChart.resize());
                };

                onMounted(initChart);

                const onScoreChange = (row) => { row.isQualified = row.score >= campGoals.passScoreThreshold; };

                const saveRow = (row) => {
                    ElMessage.success(`${row.name} 的成绩保存成功`);
                    initChart(); // Refresh chart
                };

                const batchInput = () => {
                    ElMessageBox.prompt('请输入统一成绩 (0-100)', '批量录入', {
                        confirmButtonText: '确定',
                        cancelButtonText: '取消',
                        inputPattern: /^(?:100|[1-9]?[0-9])$/,
                        inputErrorMessage: '请输入0-100的整数'
                    }).then(({ value }) => {
                        const score = parseInt(value);
                        tableData.value.forEach(row => { row.score = score; row.isQualified = score >= campGoals.passScoreThreshold; });
                        ElMessage.success('批量录入成功');
                        initChart();
                    });
                };

                return { selectedCamp, tableData, chartDom, stats, campGoals, onScoreChange, saveRow, batchInput };
            }
        };

        const SchoolLayout = {
            template: '#tmpl-school-layout',
            components: { SchoolTraining, SchoolAttendance, SchoolAssessment, TrainingMonitoring },
            setup() {
                const route = useRoute();
                const activeTab = computed(() => route.query.tab || 'training');
                return { activeTab };
            }
        };

        // --- 4. Student Logic ---
        const StudentRegistration = {
            template: '#tmpl-student-registration',
            setup() {
                const plans = ref([
                    { id: 101, name: 'Java 全栈开发特训营', company: '某知名互联网公司', position: 'Java 后端开发', location: '北京·海淀', period: '4个月', enrolled: 20, headcount: 50, status: 'Open' },
                    { id: 102, name: '产品经理精英训练营', company: '某大型互联网企业', position: '产品经理', location: '上海·浦东', period: '1个月', enrolled: 15, headcount: 30, status: 'Open' },
                    { id: 103, name: '数据科学入门班', company: '未来数据科技公司', position: '数据分析师', location: '深圳·南山', period: '1个月', enrolled: 0, headcount: 100, status: 'Open' }
                ]);
                const enrollVisible = ref(false);
                const enrollForm = reactive({ name: '', school: '', intro: '' });
                const openEnroll = (plan) => { enrollVisible.value = true; };
                const confirmEnroll = () => { enrollVisible.value = false; ElMessage.success('报名已提交'); };
                return { plans, enrollVisible, enrollForm, openEnroll, confirmEnroll };
            }
        };

        const StudentMyTraining = {
            template: '#tmpl-student-mytraining',
            setup() {
                const activeSubTab = ref('status');
                const scanVisible = ref(false);
                const currentTraining = ref(null);
                
                const myPlans = ref([
                    { id: 101, name: 'Java 全栈开发特训营', company: 'Tech Giant Corp', applyTime: '2024-02-20', status: 'Passed' },
                    { id: 102, name: '产品经理精英训练营', company: 'Tech Giant Corp', applyTime: '2024-03-05', status: 'Pending' }
                ]);
                
                const scheduleList = ref([
                    { date: '2024-07-05', time: '14:00-16:00', location: '第三教学楼 301', topic: 'Java 并发编程实战', attendance: 'Present', signed: '45/50' },
                    { date: '2024-07-06', time: '09:00-11:00', location: '第三教学楼 301', topic: '分布式架构设计', attendance: 'Absent', signed: '48/50' },
                    { date: '2024-07-07', time: '14:00-16:00', location: '第三教学楼 302', topic: '微服务实战', attendance: 'Pending', signed: '0/50' }
                ]);

                const getStatusLabel = (status) => ({ 'Pending': '待审核', 'Passed': '已通过', 'Rejected': '未通过' }[status] || status);
                const getStatusType = (status) => ({ 'Pending': 'warning', 'Passed': 'success', 'Rejected': 'danger' }[status] || '');
                
                const getAttendanceLabel = (status) => ({ 'Present': '已参加', 'Absent': '缺勤', 'Pending': '待签到' }[status] || status);
                const getAttendanceType = (status) => ({ 'Present': 'success', 'Absent': 'danger', 'Pending': 'info' }[status] || '');

                const viewSchedule = (row) => {
                    currentTraining.value = row;
                    activeSubTab.value = 'schedule';
                };

                const handleScan = () => {
                    scanVisible.value = true;
                };

                const confirmScan = () => {
                    scanVisible.value = false;
                    ElMessage.success('签到成功！');
                    // Update latest pending schedule
                    const idx = scheduleList.value.findIndex(s => s.attendance === 'Pending');
                    if(idx !== -1) scheduleList.value[idx].attendance = 'Present';
                };

                // Detail Logic
                const detailVisible = ref(false);
                const currentDetail = ref(null);
                const detailStudentList = ref([]);

                const handleDetail = (row) => {
                    currentDetail.value = row;
                    detailStudentList.value = [
                        { name: '张三', school: '北京大学', status: 'Present' },
                        { name: '李四', school: '清华大学', status: 'Present' },
                        { name: '王五', school: '北京航空航天大学', status: 'Absent' },
                        { name: '自己', school: '我的大学', status: row.attendance }
                    ];
                    detailVisible.value = true;
                };

                return { activeSubTab, myPlans, scheduleList, currentTraining, scanVisible,
                         getStatusLabel, getStatusType, getAttendanceLabel, getAttendanceType,
                         viewSchedule, handleScan, confirmScan,
                         detailVisible, currentDetail, detailStudentList, handleDetail };
            }
        };

        const StudentLayout = {
            template: '#tmpl-student-layout',
            components: { StudentRegistration, StudentMyTraining },
            setup() {
                const route = useRoute();
                const activeTab = computed(() => route.query.tab || 'registration');
                return { activeTab };
            }
        };

        // ================= ROUTER & APP =================
        const routes = [
            { path: '/', redirect: '/enterprise' },
            { path: '/enterprise', component: EnterpriseLayout },
            { path: '/operation', component: OperationLayout },
            { path: '/school', component: SchoolLayout },
            { path: '/student', component: StudentLayout }
        ];

        const router = createRouter({
            history: createWebHashHistory(),
            routes
        });

        const app = createApp({
            setup() {
                const route = useRoute();
                const activePath = computed(() => `/${route.path.split('/')[1] || 'enterprise'}`);
                const currentRoleTitle = computed(() => {
                    const map = {
                        '/enterprise': '企业端控制台',
                        '/operation': '运营管理后台',
                        '/school': '学校管理中心',
                        '/student': '学生学习空间'
                    };
                    return map[activePath.value] || '培训管理系统';
                });
                return { activePath, currentRoleTitle };
            }
        });

        app.use(router);
        app.use(ElementPlus);
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component);
        }
        app.mount('#app');
    </script>
</body>
</html>
